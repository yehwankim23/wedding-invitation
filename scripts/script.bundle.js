/*! For license information please see script.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class h extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new h(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(p(n)&&p(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const r=e*Math.pow(n,t),i=Math.round(v*r*(Math.random()-.5)*2);return Math.min(y,r+i)}function b(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const _="[DEFAULT]";class T{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:_})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=_){return this.instances.has(t)}getOptions(t=_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===_?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=_){return this.component?this.component.multipleInstances?t:_:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class I{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new T(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const S=[];var C,A;(A=C||(C={}))[A.DEBUG=0]="DEBUG",A[A.VERBOSE=1]="VERBOSE",A[A.INFO=2]="INFO",A[A.WARN=3]="WARN",A[A.ERROR=4]="ERROR",A[A.SILENT=5]="SILENT";const D={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},k=C.INFO,N={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},R=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=N[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class x{constructor(t){this.name=t,this._logLevel=k,this._logHandler=R,this._userLogHandler=null,S.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in C))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...t),this._logHandler(this,C.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...t),this._logHandler(this,C.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,C.INFO,...t),this._logHandler(this,C.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,C.WARN,...t),this._logHandler(this,C.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...t),this._logHandler(this,C.ERROR,...t)}}const L=(t,e)=>e.some((e=>t instanceof e));let M,O;const P=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap,B=new WeakMap;let j={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return F.get(t);if("objectStoreNames"===e)return t.objectStoreNames||V.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function q(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),$(P.get(this))}:function(...t){return $(e.apply(z(this),t))}:function(t,...n){const r=e.call(z(this),t,...n);return V.set(r,t.sort?t.sort():[t]),$(r)}:(t instanceof IDBTransaction&&function(t){if(F.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));F.set(t,e)}(t),L(t,M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,j):t);var e}function $(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e($(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&P.set(e,t)})).catch((()=>{})),B.set(e,t),e}(t);if(U.has(t))return U.get(t);const e=q(t);return e!==t&&(U.set(t,e),B.set(e,t)),e}const z=t=>B.get(t),K=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],H=new Map;function Q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(H.get(e))return H.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=G.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!K.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return H.set(e,s),s}var W;W=j,j={...W,get:(t,e,n)=>Q(t,e)||W.get(t,e,n),has:(t,e)=>!!Q(t,e)||W.has(t,e)};class X{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Y="@firebase/app",J="0.9.25",Z=new x("@firebase/app"),tt="[DEFAULT]",et={[Y]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},nt=new Map,rt=new Map;function it(t,e){try{t.container.addComponent(e)}catch(n){Z.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function st(t){const e=t.name;if(rt.has(e))return Z.debug(`There were multiple attempts to register component ${e}.`),!1;rt.set(e,t);for(const e of nt.values())it(e,t);return!0}function ot(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const at=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ct{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}function ut(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:tt,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw at.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw at.create("no-options");const s=nt.get(i);if(s){if(f(n,s.options)&&f(r,s.config))return s;throw at.create("duplicate-app",{appName:i})}const a=new I(i);for(const t of rt.values())a.addComponent(t);const c=new ct(n,r,a);return nt.set(i,c),c}function ht(t=tt){const e=nt.get(t);if(!e&&t===tt&&o())return ut();if(!e)throw at.create("no-app",{appName:t});return e}function lt(t,e,n){var r;let i=null!==(r=et[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Z.warn(t.join(" "))}st(new E(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const dt="firebase-heartbeat-database",ft=1,pt="firebase-heartbeat-store";let gt=null;function mt(){return gt||(gt=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=$(o);return r&&o.addEventListener("upgradeneeded",(t=>{r($(o.result),t.oldVersion,t.newVersion,$(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(dt,ft,{upgrade:(t,e)=>{0===e&&t.createObjectStore(pt)}}).catch((t=>{throw at.create("idb-open",{originalErrorMessage:t.message})}))),gt}async function yt(t,e){try{const n=(await mt()).transaction(pt,"readwrite"),r=n.objectStore(pt);await r.put(e,vt(t)),await n.done}catch(t){if(t instanceof h)Z.warn(t.message);else{const e=at.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}function vt(t){return`${t.name}!${t.options.appId}`}class wt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Et(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=bt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=bt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),_t(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),_t(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function bt(){return(new Date).toISOString().substring(0,10)}class Et{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await mt();return await e.transaction(pt).objectStore(pt).get(vt(t))}catch(t){if(t instanceof h)Z.warn(t.message);else{const e=at.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function _t(t){return i(JSON.stringify({version:2,heartbeats:t})).length}st(new E("platform-logger",(t=>new X(t)),"PRIVATE")),st(new E("heartbeat",(t=>new wt(t)),"PRIVATE")),lt(Y,J,""),lt(Y,J,"esm2017"),lt("fire-js",""),lt("firebase","10.7.1","app");const Tt=(t,e)=>e.some((e=>t instanceof e));let It,St;const Ct=new WeakMap,At=new WeakMap,Dt=new WeakMap,kt=new WeakMap,Nt=new WeakMap;let Rt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return At.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Dt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Lt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function xt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(St||(St=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Mt(this),t),Lt(Ct.get(this))}:function(...t){return Lt(e.apply(Mt(this),t))}:function(t,...n){const r=e.call(Mt(this),t,...n);return Dt.set(r,t.sort?t.sort():[t]),Lt(r)}:(t instanceof IDBTransaction&&function(t){if(At.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));At.set(t,e)}(t),Tt(t,It||(It=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Rt):t);var e}function Lt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(Lt(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&Ct.set(e,t)})).catch((()=>{})),Nt.set(e,t),e}(t);if(kt.has(t))return kt.get(t);const e=xt(t);return e!==t&&(kt.set(t,e),Nt.set(e,t)),e}const Mt=t=>Nt.get(t),Ot=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],Ft=new Map;function Vt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Ft.get(e))return Ft.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Pt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Ot.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return Ft.set(e,s),s}Rt=(t=>({...t,get:(e,n,r)=>Vt(e,n)||t.get(e,n,r),has:(e,n)=>!!Vt(e,n)||t.has(e,n)}))(Rt);const Ut="@firebase/installations",Bt="0.6.4",jt=1e4,qt=`w:${Bt}`,$t="FIS_v2",zt="https://firebaseinstallations.googleapis.com/v1",Kt=36e5,Gt=new l("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Ht(t){return t instanceof h&&t.code.includes("request-failed")}function Qt({projectId:t}){return`${zt}/projects/${t}/installations`}function Wt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Xt(t,e){const n=(await e.json()).error;return Gt.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Yt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Jt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Zt(t){return new Promise((e=>{setTimeout(e,t)}))}const te=/^[cdef][\w-]{21}$/,ee="";function ne(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return te.test(e)?e:ee}catch(t){return ee}}function re(t){return`${t.appName}!${t.appId}`}const ie=new Map;function se(t,e){const n=re(t);oe(n,e),function(t,e){const n=(!ae&&"BroadcastChannel"in self&&(ae=new BroadcastChannel("[Firebase] FID Change"),ae.onmessage=t=>{oe(t.data.key,t.data.fid)}),ae);n&&n.postMessage({key:t,fid:e}),0===ie.size&&ae&&(ae.close(),ae=null)}(n,e)}function oe(t,e){const n=ie.get(t);if(n)for(const t of n)t(e)}let ae=null;const ce="firebase-installations-database",ue=1,he="firebase-installations-store";let le=null;function de(){return le||(le=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Lt(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(Lt(o.result),t.oldVersion,t.newVersion,Lt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}(ce,ue,{upgrade:(t,e)=>{0===e&&t.createObjectStore(he)}})),le}async function fe(t,e){const n=re(t),r=(await de()).transaction(he,"readwrite"),i=r.objectStore(he),s=await i.get(n);return await i.put(e,n),await r.done,s&&s.fid===e.fid||se(t,e.fid),e}async function pe(t){const e=re(t),n=(await de()).transaction(he,"readwrite");await n.objectStore(he).delete(e),await n.done}async function ge(t,e){const n=re(t),r=(await de()).transaction(he,"readwrite"),i=r.objectStore(he),s=await i.get(n),o=e(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||se(t,o.fid),o}async function me(t){let e;const n=await ge(t.appConfig,(n=>{const r=function(t){return we(t||{fid:ne(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Gt.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=Qt(t),i=Yt(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:$t,appId:t.appId,sdkVersion:qt},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Jt((()=>fetch(r,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Wt(t.authToken)}}throw await Xt("Create Installation",c)}(t,e);return fe(t.appConfig,n)}catch(n){throw Ht(n)&&409===n.customData.serverCode?await pe(t.appConfig):await fe(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ye(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry}));return n.fid===ee?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ye(t){let e=await ve(t.appConfig);for(;1===e.registrationStatus;)await Zt(100),e=await ve(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await me(t);return n||e}return e}function ve(t){return ge(t,(t=>{if(!t)throw Gt.create("installation-not-found");return we(t)}))}function we(t){return 1===(e=t).registrationStatus&&e.registrationTime+jt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function be({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${Qt(t)}/${e}/authTokens:generate`}(t,n),i=function(t,{refreshToken:e}){const n=Yt(t);return n.append("Authorization",function(t){return`${$t} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:qt,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Jt((()=>fetch(r,a)));if(c.ok)return Wt(await c.json());throw await Xt("Generate Auth Token",c)}async function Ee(t,e=!1){let n;const r=await ge(t.appConfig,(r=>{if(!Te(r))throw Gt.create("not-registered");const i=r.authToken;if(!e&&(2===(s=i).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Kt}(s)))return r;var s;if(1===i.requestStatus)return n=async function(t,e){let n=await _e(t.appConfig);for(;1===n.authToken.requestStatus;)await Zt(100),n=await _e(t.appConfig);const r=n.authToken;return 0===r.requestStatus?Ee(t,e):r}(t,e),r;{if(!navigator.onLine)throw Gt.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(r);return n=async function(t,e){try{const n=await be(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await fe(t.appConfig,r),n}catch(n){if(!Ht(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await fe(t.appConfig,n)}else await pe(t.appConfig);throw n}}(t,e),e}}));return n?await n:r.authToken}function _e(t){return ge(t,(t=>{if(!Te(t))throw Gt.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+jt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Te(t){return void 0!==t&&2===t.registrationStatus}function Ie(t){return Gt.create("missing-app-config-values",{valueName:t})}const Se="installations";st(new E(Se,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Ie("App Configuration");if(!t.name)throw Ie("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Ie(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:ot(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),st(new E("installations-internal",(t=>{const e=ot(t.getProvider("app").getImmediate(),Se).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await me(e);return r?r.catch(console.error):Ee(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await me(t);e&&await e}(n),(await Ee(n,e)).token}(e,t)}}),"PRIVATE")),lt(Ut,Bt),lt(Ut,Bt,"esm2017");const Ce="analytics",Ae="firebase_id",De="origin",ke=6e4,Ne="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Re="https://www.googletagmanager.com/gtag/js",xe=new x("@firebase/analytics"),Le=new l("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Me(t){if(!t.startsWith(Re)){const e=Le.create("invalid-gtag-resource",{gtagURL:t});return xe.warn(e.message),""}return t}function Oe(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Pe=30,Fe=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Ve(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Ue(t,e=Fe,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw Le.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Le.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new je;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ke),Be({appId:r,apiKey:i,measurementId:s},o,a,e)}async function Be(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=Fe){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener((()=>{clearTimeout(s),r(Le.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(r,e)}catch(t){if(a)return xe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:Ve(r)},s=Ne.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Le.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return i.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof h&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(i.deleteThrottleMetadata(o),a)return xe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?w(n,i.intervalMillis,Pe):w(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,l),xe.debug(`Calling attemptFetch again in ${u} millis`),Be(t,l,r,i)}}class je{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let qe,$e;async function ze(t,e,n,r,i,s,o){var a;const h=Ue(t);h.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&xe.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>xe.error(t))),e.push(h);const l=async function(){if(!c())return xe.warn(Le.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return xe.warn(Le.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?r.getId():void 0)),[d,f]=await Promise.all([h,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Re)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Me}),r=document.createElement("script"),i=`${Re}?l=${t}&id=${e}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,d.measurementId),$e&&(i("consent","default",$e),$e=void 0),i("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[De]="firebase",p.update=!0,null!=f&&(p[Ae]=f),i("config",d.measurementId,p),qe&&(i("set",qe),qe=void 0),d.measurementId}class Ke{constructor(t){this.app=t}_delete(){return delete Ge[this.app.options.appId],Promise.resolve()}}let Ge={},He=[];const Qe={};let We,Xe,Ye="dataLayer",Je=!1;function Ze(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Le.create("invalid-analytics-context",{errorInfo:e});xe.warn(n.message)}}();const r=t.options.appId;if(!r)throw Le.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Le.create("no-api-key");xe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ge[r])throw Le.create("already-exists",{id:r});if(!Je){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(Ye);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,i){let s=function(...t){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(t,e,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const r=await Oe(n);for(const n of t){const t=r.find((t=>t.measurementId===n)),i=t&&e[t.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(t){xe.error(t)}}(t,e,n,r,i)}else if("config"===i){const[i,o]=s;await async function(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const t=(await Oe(n)).find((t=>t.measurementId===i));t&&await e[t.appId]}}catch(t){xe.error(t)}t("config",i,s)}(t,e,n,r,i,o)}else if("consent"===i){const[e]=s;t("consent","update",e)}else if("get"===i){const[e,n,r]=s;t("get",e,n,r)}else if("set"===i){const[e]=s;t("set",e)}else t(i,...s)}catch(t){xe.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}(Ge,He,Qe,Ye,"gtag");Xe=t,We=e,Je=!0}return Ge[r]=ze(t,He,Qe,e,We,Ye,n),new Ke(t)}const tn="@firebase/analytics",en="0.10.0";st(new E(Ce,((t,{options:e})=>Ze(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),st(new E("analytics-internal",(function(t){try{const e=t.getProvider(Ce).getImmediate();return{logEvent:(t,n,r)=>function(t,e,n,r){t=b(t),async function(t,e,n,r,i){if(i&&i.global)t("event",n,r);else{const i=await e;t("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Xe,Ge[t.app.options.appId],e,n,r).catch((t=>xe.error(t)))}(e,t,n,r)}}catch(t){throw Le.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),lt(tn,en),lt(tn,en,"esm2017");var nn,rn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},sn={},on=on||{},an=rn||self;function cn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function un(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var hn="closure_uid_"+(1e9*Math.random()>>>0),ln=0;function dn(t,e,n){return t.call.apply(t.bind,arguments)}function fn(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function pn(t,e,n){return(pn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?dn:fn).apply(null,arguments)}function gn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function mn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function yn(){this.s=this.s,this.o=this.o}yn.prototype.s=!1,yn.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,hn)&&t[hn]||(t[hn]=++ln))},yn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function wn(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function bn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(cn(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function En(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}En.prototype.h=function(){this.defaultPrevented=!0};var _n=function(){if(!an.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};an.addEventListener("test",t,e),an.removeEventListener("test",t,e)}catch(t){}return t}();function Tn(t){return/^[\s\xa0]*$/.test(t)}function In(){var t=an.navigator;return t&&(t=t.userAgent)?t:""}function Sn(t){return-1!=In().indexOf(t)}function Cn(t){return Cn[" "](t),t}Cn[" "]=function(){};var An,Dn,kn,Nn=Sn("Opera"),Rn=Sn("Trident")||Sn("MSIE"),xn=Sn("Edge"),Ln=xn||Rn,Mn=Sn("Gecko")&&!(-1!=In().toLowerCase().indexOf("webkit")&&!Sn("Edge"))&&!(Sn("Trident")||Sn("MSIE"))&&!Sn("Edge"),On=-1!=In().toLowerCase().indexOf("webkit")&&!Sn("Edge");function Pn(){var t=an.document;return t?t.documentMode:void 0}t:{var Fn="",Vn=(Dn=In(),Mn?/rv:([^\);]+)(\)|;)/.exec(Dn):xn?/Edge\/([\d\.]+)/.exec(Dn):Rn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Dn):On?/WebKit\/(\S+)/.exec(Dn):Nn?/(?:Version)[ \/]?(\S+)/.exec(Dn):void 0);if(Vn&&(Fn=Vn?Vn[1]:""),Rn){var Un=Pn();if(null!=Un&&Un>parseFloat(Fn)){An=String(Un);break t}}An=Fn}an.document&&Rn?kn=Pn()||parseInt(An,10)||void 0:kn=void 0;var Bn=kn;function jn(t,e){if(En.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Mn){t:{try{Cn(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:qn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&jn.$.h.call(this)}}mn(jn,En);var qn={2:"touch",3:"pen",4:"mouse"};jn.prototype.h=function(){jn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var $n="closure_listenable_"+(1e6*Math.random()|0),zn=0;function Kn(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++zn,this.fa=this.ia=!1}function Gn(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Hn(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Qn(t){const e={};for(const n in t)e[n]=t[n];return e}const Wn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xn(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<Wn.length;e++)n=Wn[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Yn(t){this.src=t,this.g={},this.h=0}function Jn(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=vn(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Gn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Zn(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}Yn.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=Zn(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Kn(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var tr="closure_lm_"+(1e6*Math.random()|0),er={};function nr(t,e,n,r,i){if(r&&r.once)return ir(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nr(t,e[s],n,r,i);return null}return n=lr(n),t&&t[$n]?t.O(e,n,un(r)?!!r.capture:!!r,i):rr(t,e,n,!1,r,i)}function rr(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=un(i)?!!i.capture:!!i,a=ur(t);if(a||(t[tr]=a=new Yn(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){const t=cr;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)_n||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ar(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ir(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ir(t,e[s],n,r,i);return null}return n=lr(n),t&&t[$n]?t.P(e,n,un(r)?!!r.capture:!!r,i):rr(t,e,n,!0,r,i)}function sr(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)sr(t,e[s],n,r,i);else r=un(r)?!!r.capture:!!r,n=lr(n),t&&t[$n]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Zn(s=t.g[e],n,r,i))&&(Gn(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=ur(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Zn(e,n,r,i)),(n=-1<t?e[t]:null)&&or(n))}function or(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[$n])Jn(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ar(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ur(e))?(Jn(n,t),0==n.h&&(n.src=null,e[tr]=null)):Gn(t)}}}function ar(t){return t in er?er[t]:er[t]="on"+t}function cr(t,e){if(t.fa)t=!0;else{e=new jn(e,this);var n=t.listener,r=t.la||t.src;t.ia&&or(t),t=n.call(r,e)}return t}function ur(t){return(t=t[tr])instanceof Yn?t:null}var hr="__closure_events_fn_"+(1e9*Math.random()>>>0);function lr(t){return"function"==typeof t?t:(t[hr]||(t[hr]=function(e){return t.handleEvent(e)}),t[hr])}function dr(){yn.call(this),this.i=new Yn(this),this.S=this,this.J=null}function fr(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new En(e,t);else if(e instanceof En)e.target=e.target||t;else{var i=e;Xn(e=new En(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=pr(o,r,!0,e)&&i}if(i=pr(o=e.g=t,r,!0,e)&&i,i=pr(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=pr(o=e.g=n[s],r,!1,e)&&i}function pr(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Jn(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}mn(dr,yn),dr.prototype[$n]=!0,dr.prototype.removeEventListener=function(t,e,n,r){sr(this,t,e,n,r)},dr.prototype.N=function(){if(dr.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Gn(n[r]);delete e.g[t],e.h--}}this.J=null},dr.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},dr.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var gr=an.JSON.stringify;function mr(){var t=Tr;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var yr=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new vr),(t=>t.reset()));class vr{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function wr(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function br(t){an.setTimeout((()=>{throw t}),0)}let Er,_r=!1,Tr=new class{constructor(){this.h=this.g=null}add(t,e){const n=yr.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Ir=()=>{const t=an.Promise.resolve(void 0);Er=()=>{t.then(Sr)}};var Sr=()=>{for(var t;t=mr();){try{t.h.call(t.g)}catch(t){br(t)}var e=yr;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}_r=!1};function Cr(t,e){dr.call(this),this.h=t||1,this.g=e||an,this.j=pn(this.qb,this),this.l=Date.now()}function Ar(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Dr(t,e,n){if("function"==typeof t)n&&(t=pn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=pn(t.handleEvent,t)}return 2147483647<Number(e)?-1:an.setTimeout(t,e||0)}function kr(t){t.g=Dr((()=>{t.g=null,t.i&&(t.i=!1,kr(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}mn(Cr,dr),(nn=Cr.prototype).ga=!1,nn.T=null,nn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),fr(this,"tick"),this.ga&&(Ar(this),this.start()))}},nn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nn.N=function(){Cr.$.N.call(this),Ar(this),delete this.g};class Nr extends yn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:kr(this)}N(){super.N(),this.g&&(an.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rr(t){yn.call(this),this.h=t,this.g={}}mn(Rr,yn);var xr=[];function Lr(t,e,n,r){Array.isArray(n)||(n&&(xr[0]=n.toString()),n=xr);for(var i=0;i<n.length;i++){var s=nr(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Mr(t){Hn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&or(t)}),t),t.g={}}function Or(){this.g=!0}function Pr(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return gr(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Rr.prototype.N=function(){Rr.$.N.call(this),Mr(this)},Rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Or.prototype.Ea=function(){this.g=!1},Or.prototype.info=function(){};var Fr={},Vr=null;function Ur(){return Vr=Vr||new dr}function Br(t){En.call(this,Fr.Ta,t)}function jr(t){const e=Ur();fr(e,new Br(e))}function qr(t,e){En.call(this,Fr.STAT_EVENT,t),this.stat=e}function $r(t){const e=Ur();fr(e,new qr(e,t))}function zr(t,e){En.call(this,Fr.Ua,t),this.size=e}function Kr(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return an.setTimeout((function(){t()}),e)}Fr.Ta="serverreachability",mn(Br,En),Fr.STAT_EVENT="statevent",mn(qr,En),Fr.Ua="timingevent",mn(zr,En);var Gr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Hr={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Qr(){}function Wr(t){return t.h||(t.h=t.i())}function Xr(){}Qr.prototype.h=null;var Yr,Jr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Zr(){En.call(this,"d")}function ti(){En.call(this,"c")}function ei(){}function ni(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Rr(this),this.P=ii,t=Ln?125:void 0,this.V=new Cr(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ri}function ri(){this.i=null,this.g="",this.h=!1}mn(Zr,En),mn(ti,En),mn(ei,Qr),ei.prototype.g=function(){return new XMLHttpRequest},ei.prototype.i=function(){return{}},Yr=new ei;var ii=45e3,si={},oi={};function ai(t,e,n){t.L=1,t.A=Ci(Ei(e)),t.u=n,t.S=!0,ci(t,null)}function ci(t,e){t.G=Date.now(),di(t),t.B=Ei(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Ui(n.i,"t",r),t.o=0,n=t.l.J,t.h=new ri,t.g=Us(t.l,n?e:null,!t.u),0<t.O&&(t.M=new Nr(pn(t.Pa,t,t.g),t.O)),Lr(t.U,t.g,"readystatechange",t.nb),e=t.I?Qn(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),jr(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function ui(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function hi(t,e,n){let r,i=!0;for(;!t.J&&t.o<n.length;){if(r=li(t,n),r==oi){4==e&&(t.s=4,$r(14),i=!1),Pr(t.j,t.m,null,"[Incomplete Response]");break}if(r==si){t.s=4,$r(15),Pr(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Pr(t.j,t.m,r,null),yi(t,r)}ui(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,$r(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Rs(e),e.M=!0,$r(11))):(Pr(t.j,t.m,n,"[Invalid Chunked Response]"),mi(t),gi(t))}function li(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?oi:(n=Number(e.substring(n,r)),isNaN(n)?si:(r+=1)+n>e.length?oi:(e=e.slice(r,r+n),t.o=r+n,e))}function di(t){t.Y=Date.now()+t.P,fi(t,t.P)}function fi(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=Kr(pn(t.lb,t),e)}function pi(t){t.C&&(an.clearTimeout(t.C),t.C=null)}function gi(t){0==t.l.H||t.J||Ms(t.l,t)}function mi(t){pi(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Ar(t.V),Mr(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function yi(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Gi(n.i,t)))if(!t.K&&Gi(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Ls(n),Ts(n)}Ns(n),$r(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Kr(pn(n.ib,n),6e3));if(1>=Ki(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Ps(n,11)}else if((t.K||n.g==t)&&Ls(n),!Tn(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Hi(s,s.h),s.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Si(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Vs(r,r.J?r.pa:null,r.Y),o.K){Qi(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(pi(a),di(a)),r.g=o}else ks(r);0<n.j.length&&Ss(n)}else"stop"!=u[0]&&"close"!=u[0]||Ps(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Ps(n,7):_s(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}jr()}catch(t){}}function vi(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(cn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(cn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(cn(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(nn=ni.prototype).setTimeout=function(t){this.P=t},nn.nb=function(t){t=t.target;const e=this.M;e&&3==ms(t)?e.l():this.Pa(t)},nn.Pa=function(t){try{if(t==this.g)t:{const h=ms(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||Ln||this.g&&(this.h.h||this.g.ja()||ys(this.g)))){this.J||4!=h||7==e||jr(),pi(this);var n=this.g.da();this.ca=n;e:if(ui(this)){var r=ys(this.g);t="";var i=r.length,s=4==ms(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){mi(this),gi(this);var o="";break e}this.h.i=new an.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Tn(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,$r(12),mi(this),gi(this);break t}Pr(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yi(this,n)}this.S?(hi(this,h,o),Ln&&this.i&&3==h&&(Lr(this.U,this.V,"tick",this.mb),this.V.start())):(Pr(this.j,this.m,o,null),yi(this,o)),4==h&&mi(this),this.i&&!this.J&&(4==h?Ms(this.l,this):(this.i=!1,di(this)))}else(function(t){const e={};t=(t.g&&2<=ms(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Tn(t[r]))continue;var n=wr(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,$r(12)):(this.s=0,$r(13)),mi(this),gi(this)}}}catch(t){}},nn.mb=function(){if(this.g){var t=ms(this.g),e=this.g.ja();this.o<e.length&&(pi(this),hi(this,t,e),this.i&&4!=t&&di(this))}},nn.cancel=function(){this.J=!0,mi(this)},nn.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(jr(),$r(17)),mi(this),this.s=2,gi(this)):fi(this,this.Y-t)};var wi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bi(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof bi){this.h=t.h,_i(this,t.j),this.s=t.s,this.g=t.g,Ti(this,t.m),this.l=t.l;var e=t.i,n=new Oi;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ii(this,n),this.o=t.o}else t&&(e=String(t).match(wi))?(this.h=!1,_i(this,e[1]||"",!0),this.s=Ai(e[2]||""),this.g=Ai(e[3]||"",!0),Ti(this,e[4]),this.l=Ai(e[5]||"",!0),Ii(this,e[6]||"",!0),this.o=Ai(e[7]||"")):(this.h=!1,this.i=new Oi(null,this.h))}function Ei(t){return new bi(t)}function _i(t,e,n){t.j=n?Ai(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ti(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ii(t,e,n){e instanceof Oi?(t.i=e,function(t,e){e&&!t.j&&(Pi(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Fi(this,e),Ui(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Di(e,Li)),t.i=new Oi(e,t.h))}function Si(t,e,n){t.i.set(e,n)}function Ci(t){return Si(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ai(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Di(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ki),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ki(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}bi.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Di(e,Ni,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Di(e,Ni,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Di(n,"/"==n.charAt(0)?xi:Ri,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Di(n,Mi)),t.join("")};var Ni=/[#\/\?@]/g,Ri=/[#\?:]/g,xi=/[#\?]/g,Li=/[#\?@]/g,Mi=/#/g;function Oi(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Pi(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Fi(t,e){Pi(t),e=Bi(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Vi(t,e){return Pi(t),e=Bi(t,e),t.g.has(e)}function Ui(t,e,n){Fi(t,e),0<n.length&&(t.i=null,t.g.set(Bi(t,e),wn(n)),t.h+=n.length)}function Bi(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(nn=Oi.prototype).add=function(t,e){Pi(this),this.i=null,t=Bi(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},nn.forEach=function(t,e){Pi(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},nn.ta=function(){Pi(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},nn.Z=function(t){Pi(this);let e=[];if("string"==typeof t)Vi(this,t)&&(e=e.concat(this.g.get(Bi(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},nn.set=function(t,e){return Pi(this),this.i=null,Vi(this,t=Bi(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},nn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},nn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var ji=class{constructor(t,e){this.g=t,this.map=e}};function qi(t){this.l=t||$i,t=an.PerformanceNavigationTiming?0<(t=an.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(an.g&&an.g.Ka&&an.g.Ka()&&an.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var $i=10;function zi(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ki(t){return t.h?1:t.g?t.g.size:0}function Gi(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Hi(t,e){t.g?t.g.add(e):t.h=e}function Qi(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Wi(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return wn(t.i)}qi.prototype.cancel=function(){if(this.i=Wi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Xi=class{stringify(t){return an.JSON.stringify(t,void 0)}parse(t){return an.JSON.parse(t,void 0)}};function Yi(){this.g=new Xi}function Ji(t,e,n){const r=n||"";try{vi(t,(function(t,n){let i=t;un(t)&&(i=gr(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Zi(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function ts(t){this.l=t.ec||null,this.j=t.ob||!1}function es(t,e){dr.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=ns,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}mn(ts,Qr),ts.prototype.g=function(){return new es(this.l,this.j)},ts.prototype.i=function(t){return function(){return t}}({}),mn(es,dr);var ns=0;function rs(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function is(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ss(t)}function ss(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(nn=es.prototype).open=function(t,e){if(this.readyState!=ns)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ss(this)},nn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||an).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},nn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,is(this)),this.readyState=ns},nn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ss(this)),this.g&&(this.readyState=3,ss(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==an.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;rs(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},nn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?is(this):ss(this),3==this.readyState&&rs(this)}},nn.Za=function(t){this.g&&(this.response=this.responseText=t,is(this))},nn.Ya=function(t){this.g&&(this.response=t,is(this))},nn.ka=function(){this.g&&is(this)},nn.setRequestHeader=function(t,e){this.v.append(t,e)},nn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},nn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(es.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var os=an.JSON.parse;function as(t){dr.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=cs,this.L=this.M=!1}mn(as,dr);var cs="",us=/^https?$/i,hs=["POST","PUT"];function ls(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,ds(t),ps(t)}function ds(t){t.F||(t.F=!0,fr(t,"complete"),fr(t,"error"))}function fs(t){if(t.h&&void 0!==on&&(!t.C[1]||4!=ms(t)||2!=t.da()))if(t.v&&4==ms(t))Dr(t.La,0,t);else if(fr(t,"readystatechange"),4==ms(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(wi)[1]||null;!i&&an.self&&an.self.location&&(i=an.self.location.protocol.slice(0,-1)),r=!us.test(i?i.toLowerCase():"")}n=r}if(n)fr(t,"complete"),fr(t,"success");else{t.m=6;try{var s=2<ms(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",ds(t)}}finally{ps(t)}}}function ps(t,e){if(t.g){gs(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||fr(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function gs(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(an.clearTimeout(t.A),t.A=null)}function ms(t){return t.g?t.g.readyState:0}function ys(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case cs:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function vs(t){let e="";return Hn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function ws(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=vs(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Si(t,e,n))}function bs(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Es(t){this.Ga=0,this.j=[],this.l=new Or,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=bs("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=bs("baseRetryDelayMs",5e3,t),this.hb=bs("retryDelaySeedMs",1e4,t),this.eb=bs("forwardChannelMaxRetries",2,t),this.xa=bs("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new qi(t&&t.concurrentRequestLimit),this.Ja=new Yi,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function _s(t){if(Is(t),3==t.H){var e=t.W++,n=Ei(t.I);if(Si(n,"SID",t.K),Si(n,"RID",e),Si(n,"TYPE","terminate"),As(t,n),(e=new ni(t,t.l,e)).L=2,e.A=Ci(Ei(n)),n=!1,an.navigator&&an.navigator.sendBeacon)try{n=an.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&an.Image&&((new Image).src=e.A,n=!0),n||(e.g=Us(e.l,null),e.g.ha(e.A)),e.G=Date.now(),di(e)}Fs(t)}function Ts(t){t.g&&(Rs(t),t.g.cancel(),t.g=null)}function Is(t){Ts(t),t.u&&(an.clearTimeout(t.u),t.u=null),Ls(t),t.i.cancel(),t.m&&("number"==typeof t.m&&an.clearTimeout(t.m),t.m=null)}function Ss(t){if(!zi(t.i)&&!t.m){t.m=!0;var e=t.Na;Er||Ir(),_r||(Er(),_r=!0),Tr.add(e,t),t.C=0}}function Cs(t,e){var n;n=e?e.m:t.W++;const r=Ei(t.I);Si(r,"SID",t.K),Si(r,"RID",n),Si(r,"AID",t.V),As(t,r),t.o&&t.s&&ws(r,t.o,t.s),n=new ni(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Ds(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Hi(t.i,n),ai(n,r,e)}function As(t,e){t.na&&Hn(t.na,(function(t,n){Si(e,n,t)})),t.h&&vi({},(function(t,n){Si(e,n,t)}))}function Ds(t,e,n){n=Math.min(t.j.length,n);var r=t.h?pn(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{Ji(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function ks(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Er||Ir(),_r||(Er(),_r=!0),Tr.add(e,t),t.A=0}}function Ns(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Kr(pn(t.Ma,t),Os(t,t.A)),t.A++,0))}function Rs(t){null!=t.B&&(an.clearTimeout(t.B),t.B=null)}function xs(t){t.g=new ni(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ei(t.wa);Si(e,"RID","rpc"),Si(e,"SID",t.K),Si(e,"AID",t.V),Si(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Si(e,"TO",t.qa),Si(e,"TYPE","xmlhttp"),As(t,e),t.o&&t.s&&ws(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Ci(Ei(e)),n.u=null,n.S=!0,ci(n,t)}function Ls(t){null!=t.v&&(an.clearTimeout(t.v),t.v=null)}function Ms(t,e){var n=null;if(t.g==e){Ls(t),Rs(t),t.g=null;var r=2}else{if(!Gi(t.i,e))return;n=e.F,Qi(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;fr(r=Ur(),new zr(r,n)),Ss(t)}else ks(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(Ki(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Kr(pn(t.Na,t,e),Os(t,t.C)),t.C++,0)))}(t,e)||2==r&&Ns(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Ps(t,5);break;case 4:Ps(t,10);break;case 3:Ps(t,6);break;default:Ps(t,2)}}function Os(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Ps(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=pn(t.pb,t);n||(n=new bi("//www.google.com/images/cleardot.gif"),an.location&&"http"==an.location.protocol||_i(n,"https"),Ci(n)),function(t,e){const n=new Or;if(an.Image){const r=new Image;r.onload=gn(Zi,n,r,"TestLoadImage: loaded",!0,e),r.onerror=gn(Zi,n,r,"TestLoadImage: error",!1,e),r.onabort=gn(Zi,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=gn(Zi,n,r,"TestLoadImage: timeout",!1,e),an.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else $r(2);t.H=0,t.h&&t.h.za(e),Fs(t),Is(t)}function Fs(t){if(t.H=0,t.ma=[],t.h){const e=Wi(t.i);0==e.length&&0==t.j.length||(bn(t.ma,e),bn(t.ma,t.j),t.i.i.length=0,wn(t.j),t.j.length=0),t.h.ya()}}function Vs(t,e,n){var r=n instanceof bi?Ei(n):new bi(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Ti(r,r.m);else{var i=an.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new bi(null);r&&_i(s,r),e&&(s.g=e),i&&Ti(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Si(r,n,e),Si(r,"VER",t.ra),As(t,r),r}function Us(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new as(new ts({ob:n})):new as(t.va)).Oa(t.J),e}function Bs(){}function js(){if(Rn&&!(10<=Number(Bn)))throw Error("Environmental error: no available transport.")}function qs(t,e){dr.call(this),this.g=new Es(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Tn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Tn(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Ks(this)}function $s(t){Zr.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function zs(){ti.call(this),this.status=1}function Ks(t){this.g=t}function Gs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Hs(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function Qs(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(nn=as.prototype).Oa=function(t){this.M=t},nn.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Yr.g(),this.C=this.u?Wr(this.u):Wr(Yr),this.g.onreadystatechange=pn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void ls(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=an.FormData&&t instanceof an.FormData,!(0<=vn(hs,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{gs(this),0<this.B&&((this.L=function(t){return Rn&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pn(this.ua,this)):this.A=Dr(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){ls(this,t)}},nn.ua=function(){void 0!==on&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,fr(this,"timeout"),this.abort(8))},nn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,fr(this,"complete"),fr(this,"abort"),ps(this))},nn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ps(this,!0)),as.$.N.call(this)},nn.La=function(){this.s||(this.G||this.v||this.l?fs(this):this.kb())},nn.kb=function(){fs(this)},nn.isActive=function(){return!!this.g},nn.da=function(){try{return 2<ms(this)?this.g.status:-1}catch(t){return-1}},nn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},nn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),os(e)}},nn.Ia=function(){return this.m},nn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(nn=Es.prototype).ra=8,nn.H=1,nn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new ni(this,this.l,t);let s=this.s;if(this.U&&(s?(s=Qn(s),Xn(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Ds(this,i,e),Si(n=Ei(this.I),"RID",t),Si(n,"CVER",22),this.F&&Si(n,"X-HTTP-Session-Id",this.F),As(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(vs(s)))+"&"+e:this.o&&ws(n,this.o,s)),Hi(this.i,i),this.bb&&Si(n,"TYPE","init"),this.P?(Si(n,"$req",e),Si(n,"SID","null"),i.aa=!0,ai(i,n,null)):ai(i,n,e),this.H=2}}else 3==this.H&&(t?Cs(this,t):0==this.j.length||zi(this.i)||Cs(this))},nn.Ma=function(){if(this.u=null,xs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Kr(pn(this.jb,this),t)}},nn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,$r(10),Ts(this),xs(this))},nn.ib=function(){null!=this.v&&(this.v=null,Ts(this),Ns(this),$r(19))},nn.pb=function(t){t?(this.l.info("Successfully pinged google.com"),$r(2)):(this.l.info("Failed to ping google.com"),$r(1))},nn.isActive=function(){return!!this.h&&this.h.isActive(this)},(nn=Bs.prototype).Ba=function(){},nn.Aa=function(){},nn.za=function(){},nn.ya=function(){},nn.isActive=function(){return!0},nn.Va=function(){},js.prototype.g=function(t,e){return new qs(t,e)},mn(qs,dr),qs.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;$r(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Vs(t,null,t.Y),Ss(t)},qs.prototype.close=function(){_s(this.g)},qs.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=gr(t),t=n);e.j.push(new ji(e.fb++,t)),3==e.H&&Ss(e)},qs.prototype.N=function(){this.g.h=null,delete this.j,_s(this.g),delete this.g,qs.$.N.call(this)},mn($s,Zr),mn(zs,ti),mn(Ks,Bs),Ks.prototype.Ba=function(){fr(this.g,"a")},Ks.prototype.Aa=function(t){fr(this.g,new $s(t))},Ks.prototype.za=function(t){fr(this.g,new zs)},Ks.prototype.ya=function(){fr(this.g,"b")},mn(Gs,(function(){this.blockSize=-1})),Gs.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Gs.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)Hs(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){Hs(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){Hs(this,r),i=0;break}}this.h=i,this.i+=e},Gs.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var Ws={};function Xs(t){return-128<=t&&128>t?function(t,e){var n=Ws;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Qs([0|t],0>t?-1:0)}(t)}(t):new Qs([0|t],0>t?-1:0)}function Ys(t){if(isNaN(t)||!isFinite(t))return Zs;if(0>t)return io(Ys(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=Js;return new Qs(e,0)}var Js=4294967296,Zs=Xs(0),to=Xs(1),eo=Xs(16777216);function no(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function ro(t){return-1==t.h}function io(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new Qs(n,~t.h).add(to)}function so(t,e){return t.add(io(e))}function oo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ao(t,e){this.g=t,this.h=e}function co(t,e){if(no(e))throw Error("division by zero");if(no(t))return new ao(Zs,Zs);if(ro(t))return e=co(io(t),e),new ao(io(e.g),io(e.h));if(ro(e))return e=co(t,io(e)),new ao(io(e.g),e.h);if(30<t.g.length){if(ro(t)||ro(e))throw Error("slowDivide_ only works with positive integers.");for(var n=to,r=e;0>=r.X(t);)n=uo(n),r=uo(r);var i=ho(n,1),s=ho(r,1);for(r=ho(r,2),n=ho(n,2);!no(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=ho(r,1),n=ho(n,1)}return e=so(t,i.R(e)),new ao(i,e)}for(i=Zs;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Ys(n)).R(e);ro(o)||0<o.X(t);)o=(s=Ys(n-=r)).R(e);no(s)&&(s=to),i=i.add(s),t=so(t,o)}return new ao(i,t)}function uo(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new Qs(n,t.h)}function ho(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new Qs(i,t.h)}(nn=Qs.prototype).ea=function(){if(ro(this))return-io(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:Js+r)*e,e*=Js}return t},nn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(no(this))return"0";if(ro(this))return"-"+io(this).toString(t);for(var e=Ys(Math.pow(t,6)),n=this,r="";;){var i=co(n,e).g,s=((0<(n=so(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(no(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},nn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},nn.X=function(t){return ro(t=so(this,t))?-1:no(t)?0:1},nn.abs=function(){return ro(this)?io(this):this},nn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Qs(n,-2147483648&n[n.length-1]?-1:0)},nn.R=function(t){if(no(this)||no(t))return Zs;if(ro(this))return ro(t)?io(this).R(io(t)):io(io(this).R(t));if(ro(t))return io(this.R(io(t)));if(0>this.X(eo)&&0>t.X(eo))return Ys(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,c=65535&t.D(i);n[2*r+2*i]+=o*c,oo(n,2*r+2*i),n[2*r+2*i+1]+=s*c,oo(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,oo(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,oo(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new Qs(n,0)},nn.gb=function(t){return co(this,t).h},nn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new Qs(n,this.h&t.h)},nn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new Qs(n,this.h|t.h)},nn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new Qs(n,this.h^t.h)},js.prototype.createWebChannel=js.prototype.g,qs.prototype.send=qs.prototype.u,qs.prototype.open=qs.prototype.m,qs.prototype.close=qs.prototype.close,Gr.NO_ERROR=0,Gr.TIMEOUT=8,Gr.HTTP_ERROR=6,Hr.COMPLETE="complete",Xr.EventType=Jr,Jr.OPEN="a",Jr.CLOSE="b",Jr.ERROR="c",Jr.MESSAGE="d",dr.prototype.listen=dr.prototype.O,as.prototype.listenOnce=as.prototype.P,as.prototype.getLastError=as.prototype.Sa,as.prototype.getLastErrorCode=as.prototype.Ia,as.prototype.getStatus=as.prototype.da,as.prototype.getResponseJson=as.prototype.Wa,as.prototype.getResponseText=as.prototype.ja,as.prototype.send=as.prototype.ha,as.prototype.setWithCredentials=as.prototype.Oa,Gs.prototype.digest=Gs.prototype.l,Gs.prototype.reset=Gs.prototype.reset,Gs.prototype.update=Gs.prototype.j,Qs.prototype.add=Qs.prototype.add,Qs.prototype.multiply=Qs.prototype.R,Qs.prototype.modulo=Qs.prototype.gb,Qs.prototype.compare=Qs.prototype.X,Qs.prototype.toNumber=Qs.prototype.ea,Qs.prototype.toString=Qs.prototype.toString,Qs.prototype.getBits=Qs.prototype.D,Qs.fromNumber=Ys,Qs.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return io(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Ys(Math.pow(n,8)),i=Zs,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=Ys(Math.pow(n,o)),i=i.R(o).add(Ys(a))):i=(i=i.R(r)).add(Ys(a))}return i};var lo=sn.createWebChannelTransport=function(){return new js},fo=sn.getStatEventTarget=function(){return Ur()},po=sn.ErrorCode=Gr,go=sn.EventType=Hr,mo=sn.Event=Fr,yo=sn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},vo=(sn.FetchXmlHttpFactory=ts,sn.WebChannel=Xr),wo=sn.XhrIo=as,bo=sn.Md5=Gs,Eo=sn.Integer=Qs;const _o="@firebase/firestore";class To{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}To.UNAUTHENTICATED=new To(null),To.GOOGLE_CREDENTIALS=new To("google-credentials-uid"),To.FIRST_PARTY=new To("first-party-uid"),To.MOCK_USER=new To("mock-user");let Io="10.7.0";const So=new x("@firebase/firestore");function Co(){return So.logLevel}function Ao(t,...e){if(So.logLevel<=C.DEBUG){const n=e.map(No);So.debug(`Firestore (${Io}): ${t}`,...n)}}function Do(t,...e){if(So.logLevel<=C.ERROR){const n=e.map(No);So.error(`Firestore (${Io}): ${t}`,...n)}}function ko(t,...e){if(So.logLevel<=C.WARN){const n=e.map(No);So.warn(`Firestore (${Io}): ${t}`,...n)}}function No(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ro(t="Unexpected state"){const e=`FIRESTORE (${Io}) INTERNAL ASSERTION FAILED: `+t;throw Do(e),new Error(e)}function xo(t,e){t||Ro()}function Lo(t,e){return t}const Mo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Oo extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Po{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Fo{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Vo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(To.UNAUTHENTICATED)))}shutdown(){}}class Uo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Bo{constructor(t){this.t=t,this.currentUser=To.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Po;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Po,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Ao("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Ao("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Po)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Ao("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xo("string"==typeof e.accessToken),new Fo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return xo(null===t||"string"==typeof t),new To(t)}}class jo{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=To.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class qo{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new jo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(To.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class $o{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zo{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Ao("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Ao("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Ao("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Ao("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(xo("string"==typeof t.token),this.R=t.token,new $o(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ko(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Go{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ko(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ho(t,e){return t<e?-1:t>e?1:0}function Qo(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Wo{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Wo.fromMillis(Date.now())}static fromDate(t){return Wo.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Wo(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Ho(this.nanoseconds,t.nanoseconds):Ho(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xo{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Xo(t)}static min(){return new Xo(new Wo(0,0))}static max(){return new Xo(new Wo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Yo{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ro(),void 0===n?n=t.length-e:n>t.length-e&&Ro(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Yo.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Yo?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Jo extends Yo{construct(t,e,n){return new Jo(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Jo(e)}static emptyPath(){return new Jo([])}}const Zo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ta extends Yo{construct(t,e,n){return new ta(t,e,n)}static isValidIdentifier(t){return Zo.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ta.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ta(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Oo(Mo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Oo(Mo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Oo(Mo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ta(e)}static emptyPath(){return new ta([])}}class ea{constructor(t){this.path=t}static fromPath(t){return new ea(Jo.fromString(t))}static fromName(t){return new ea(Jo.fromString(t).popFirst(5))}static empty(){return new ea(Jo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Jo.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Jo.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ea(new Jo(t.slice()))}}function na(t){return new ra(t.readTime,t.key,-1)}class ra{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ra(Xo.min(),ea.empty(),-1)}static max(){return new ra(Xo.max(),ea.empty(),-1)}}function ia(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ea.comparator(t.documentKey,e.documentKey),0!==n?n:Ho(t.largestBatchId,e.largestBatchId))}const sa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function aa(t){if(t.code!==Mo.FAILED_PRECONDITION||t.message!==sa)throw t;Ao("LocalStore","Unexpectedly lost primary lease")}class ca{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ro(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ca(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ca?e:ca.resolve(e)}catch(t){return ca.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ca.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ca.reject(e)}static resolve(t){return new ca(((e,n)=>{e(t)}))}static reject(t){return new ca(((e,n)=>{n(t)}))}static waitFor(t){return new ca(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=ca.resolve(!1);for(const n of t)e=e.next((t=>t?ca.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new ca(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new ca(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function ua(t){return"IndexedDbTransactionError"===t.name}class ha{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function la(t){return null==t}function da(t){return 0===t&&1/t==-1/0}ha._e=-1;function fa(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function pa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ga(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ma{constructor(t,e){this.comparator=t,this.root=e||va.EMPTY}insert(t,e){return new ma(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,va.BLACK,null,null))}remove(t){return new ma(this.comparator,this.root.remove(t,this.comparator).copy(null,null,va.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ya(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ya(this.root,t,this.comparator,!1)}getReverseIterator(){return new ya(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ya(this.root,t,this.comparator,!0)}}class ya{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class va{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:va.RED,this.left=null!=r?r:va.EMPTY,this.right=null!=i?i:va.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new va(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return va.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return va.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,va.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,va.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ro();if(this.right.isRed())throw Ro();const t=this.left.check();if(t!==this.right.check())throw Ro();return t+(this.isRed()?0:1)}}va.EMPTY=null,va.RED=!0,va.BLACK=!1,va.EMPTY=new class{constructor(){this.size=0}get key(){throw Ro()}get value(){throw Ro()}get color(){throw Ro()}get left(){throw Ro()}get right(){throw Ro()}copy(t,e,n,r,i){return this}insert(t,e,n){return new va(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class wa{constructor(t){this.comparator=t,this.data=new ma(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ba(this.data.getIterator())}getIteratorFrom(t){return new ba(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof wa))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new wa(this.comparator);return e.data=t,e}}class ba{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ea{constructor(t){this.fields=t,t.sort(ta.comparator)}static empty(){return new Ea([])}unionWith(t){let e=new wa(ta.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ea(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Qo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class _a extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ta{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new _a("Invalid base64 string: "+t):t}}(t);return new Ta(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ta(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ho(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ta.EMPTY_BYTE_STRING=new Ta("");const Ia=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sa(t){if(xo(!!t),"string"==typeof t){let e=0;const n=Ia.exec(t);if(xo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ca(t.seconds),nanos:Ca(t.nanos)}}function Ca(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Aa(t){return"string"==typeof t?Ta.fromBase64String(t):Ta.fromUint8Array(t)}function Da(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ka(t){const e=t.mapValue.fields.__previous_value__;return Da(e)?ka(e):e}function Na(t){const e=Sa(t.mapValue.fields.__local_write_time__.timestampValue);return new Wo(e.seconds,e.nanos)}class Ra{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class xa{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new xa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof xa&&t.projectId===this.projectId&&t.database===this.database}}const La={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ma(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Da(t)?4:Qa(t)?9007199254740991:10:Ro()}function Oa(t,e){if(t===e)return!0;const n=Ma(t);if(n!==Ma(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Na(t).isEqual(Na(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Sa(t.timestampValue),r=Sa(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Aa(t.bytesValue).isEqual(Aa(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ca(t.geoPointValue.latitude)===Ca(e.geoPointValue.latitude)&&Ca(t.geoPointValue.longitude)===Ca(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ca(t.integerValue)===Ca(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ca(t.doubleValue),r=Ca(e.doubleValue);return n===r?da(n)===da(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Qo(t.arrayValue.values||[],e.arrayValue.values||[],Oa);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(fa(n)!==fa(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Oa(n[t],r[t])))return!1;return!0}(t,e);default:return Ro()}}function Pa(t,e){return void 0!==(t.values||[]).find((t=>Oa(t,e)))}function Fa(t,e){if(t===e)return 0;const n=Ma(t),r=Ma(e);if(n!==r)return Ho(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ho(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ca(t.integerValue||t.doubleValue),r=Ca(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Va(t.timestampValue,e.timestampValue);case 4:return Va(Na(t),Na(e));case 5:return Ho(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Aa(t),r=Aa(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ho(n[t],r[t]);if(0!==e)return e}return Ho(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ho(Ca(t.latitude),Ca(e.latitude));return 0!==n?n:Ho(Ca(t.longitude),Ca(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Fa(n[t],r[t]);if(e)return e}return Ho(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===La.mapValue&&e===La.mapValue)return 0;if(t===La.mapValue)return 1;if(e===La.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Ho(r[t],s[t]);if(0!==e)return e;const o=Fa(n[r[t]],i[s[t]]);if(0!==o)return o}return Ho(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Ro()}}function Va(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ho(t,e);const n=Sa(t),r=Sa(e),i=Ho(n.seconds,r.seconds);return 0!==i?i:Ho(n.nanos,r.nanos)}function Ua(t){return Ba(t)}function Ba(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Sa(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Aa(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ea.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Ba(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Ba(t.fields[i])}`;return n+"}"}(t.mapValue):Ro()}function ja(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function qa(t){return!!t&&"integerValue"in t}function $a(t){return!!t&&"arrayValue"in t}function za(t){return!!t&&"nullValue"in t}function Ka(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ga(t){return!!t&&"mapValue"in t}function Ha(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return pa(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ha(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ha(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Qa(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Wa{constructor(t){this.value=t}static empty(){return new Wa({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ga(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ha(e)}setAll(t){let e=ta.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ha(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Ga(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Oa(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Ga(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){pa(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Wa(Ha(this.value))}}function Xa(t){const e=[];return pa(t.fields,((t,n)=>{const r=new ta([t]);if(Ga(n)){const t=Xa(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Ea(e)}class Ya{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new Ya(t,0,Xo.min(),Xo.min(),Xo.min(),Wa.empty(),0)}static newFoundDocument(t,e,n,r){return new Ya(t,1,e,Xo.min(),n,r,0)}static newNoDocument(t,e){return new Ya(t,2,e,Xo.min(),Xo.min(),Wa.empty(),0)}static newUnknownDocument(t,e){return new Ya(t,3,e,Xo.min(),Xo.min(),Wa.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Xo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Wa.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Wa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xo.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ya&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ya(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ja{constructor(t,e){this.position=t,this.inclusive=e}}function Za(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ea.comparator(ea.fromName(o.referenceValue),n.key):Fa(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function tc(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Oa(t.position[n],e.position[n]))return!1;return!0}class ec{constructor(t,e="asc"){this.field=t,this.dir=e}}function nc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class rc{}class ic extends rc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new lc(t,e,n):"array-contains"===e?new gc(t,n):"in"===e?new mc(t,n):"not-in"===e?new yc(t,n):"array-contains-any"===e?new vc(t,n):new ic(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new dc(t,n):new fc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Fa(e,this.value)):null!==e&&Ma(this.value)===Ma(e)&&this.matchesComparison(Fa(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ro()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sc extends rc{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new sc(t,e)}matches(t){return oc(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function oc(t){return"and"===t.op}function ac(t){return function(t){for(const e of t.filters)if(e instanceof sc)return!1;return!0}(t)&&oc(t)}function cc(t){if(t instanceof ic)return t.field.canonicalString()+t.op.toString()+Ua(t.value);if(ac(t))return t.filters.map((t=>cc(t))).join(",");{const e=t.filters.map((t=>cc(t))).join(",");return`${t.op}(${e})`}}function uc(t,e){return t instanceof ic?function(t,e){return e instanceof ic&&t.op===e.op&&t.field.isEqual(e.field)&&Oa(t.value,e.value)}(t,e):t instanceof sc?function(t,e){return e instanceof sc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&uc(n,e.filters[r])),!0)}(t,e):void Ro()}function hc(t){return t instanceof ic?function(t){return`${t.field.canonicalString()} ${t.op} ${Ua(t.value)}`}(t):t instanceof sc?function(t){return t.op.toString()+" {"+t.getFilters().map(hc).join(" ,")+"}"}(t):"Filter"}class lc extends ic{constructor(t,e,n){super(t,e,n),this.key=ea.fromName(n.referenceValue)}matches(t){const e=ea.comparator(t.key,this.key);return this.matchesComparison(e)}}class dc extends ic{constructor(t,e){super(t,"in",e),this.keys=pc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class fc extends ic{constructor(t,e){super(t,"not-in",e),this.keys=pc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function pc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ea.fromName(t.referenceValue)))}class gc extends ic{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return $a(e)&&Pa(e.arrayValue,this.value)}}class mc extends ic{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Pa(this.value.arrayValue,e)}}class yc extends ic{constructor(t,e){super(t,"not-in",e)}matches(t){if(Pa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Pa(this.value.arrayValue,e)}}class vc extends ic{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!$a(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Pa(this.value.arrayValue,t)))}}class wc{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function bc(t,e=null,n=[],r=[],i=null,s=null,o=null){return new wc(t,e,n,r,i,s,o)}function Ec(t){const e=Lo(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>cc(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),la(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Ua(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Ua(t))).join(",")),e.ce=t}return e.ce}function _c(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!nc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!uc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tc(t.startAt,e.startAt)&&tc(t.endAt,e.endAt)}function Tc(t){return ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ic{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Sc(t){return new Ic(t)}function Cc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ac(t){return null!==t.collectionGroup}function Dc(t){const e=Lo(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new wa(ta.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new ec(r,n))})),t.has(ta.keyField().canonicalString())||e.le.push(new ec(ta.keyField(),n))}return e.le}function kc(t){const e=Lo(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return bc(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new ec(t.field,e)}));const n=t.endAt?new Ja(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ja(t.startAt.position,t.startAt.inclusive):null;return bc(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Dc(t))),e.he}function Nc(t,e){const n=t.filters.concat([e]);return new Ic(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Rc(t,e,n){return new Ic(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function xc(t,e){return _c(kc(t),kc(e))&&t.limitType===e.limitType}function Lc(t){return`${Ec(kc(t))}|lt:${t.limitType}`}function Mc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>hc(t))).join(", ")}]`),la(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Ua(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Ua(t))).join(",")),`Target(${e})`}(kc(t))}; limitType=${t.limitType})`}function Oc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ea.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Dc(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Za(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Dc(t),e)||t.endAt&&!function(t,e,n){const r=Za(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Dc(t),e))}(t,e)}function Pc(t){return(e,n)=>{let r=!1;for(const i of Dc(t)){const t=Fc(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Fc(t,e,n){const r=t.field.isKeyField()?ea.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Fa(r,i):Ro()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ro()}}class Vc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){pa(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return ga(this.inner)}size(){return this.innerSize}}const Uc=new ma(ea.comparator);function Bc(){return Uc}const jc=new ma(ea.comparator);function qc(...t){let e=jc;for(const n of t)e=e.insert(n.key,n);return e}function $c(t){let e=jc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function zc(){return Gc()}function Kc(){return Gc()}function Gc(){return new Vc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Hc=new ma(ea.comparator),Qc=new wa(ea.comparator);function Wc(...t){let e=Qc;for(const n of t)e=e.add(n);return e}const Xc=new wa(Ho);function Yc(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:da(e)?"-0":e}}function Jc(t){return{integerValue:""+t}}function Zc(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!da(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Jc(e):Yc(t,e)}class tu{constructor(){this._=void 0}}function eu(t,e,n){return t instanceof iu?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Da(e)&&(e=ka(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof su?ou(t,e):t instanceof au?cu(t,e):function(t,e){const n=ru(t,e),r=hu(n)+hu(t.Ie);return qa(n)&&qa(t.Ie)?Jc(r):Yc(t.serializer,r)}(t,e)}function nu(t,e,n){return t instanceof su?ou(t,e):t instanceof au?cu(t,e):n}function ru(t,e){return t instanceof uu?function(t){return qa(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class iu extends tu{}class su extends tu{constructor(t){super(),this.elements=t}}function ou(t,e){const n=lu(e);for(const e of t.elements)n.some((t=>Oa(t,e)))||n.push(e);return{arrayValue:{values:n}}}class au extends tu{constructor(t){super(),this.elements=t}}function cu(t,e){let n=lu(e);for(const e of t.elements)n=n.filter((t=>!Oa(t,e)));return{arrayValue:{values:n}}}class uu extends tu{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function hu(t){return Ca(t.integerValue||t.doubleValue)}function lu(t){return $a(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class du{constructor(t,e){this.field=t,this.transform=e}}class fu{constructor(t,e){this.version=t,this.transformResults=e}}class pu{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new pu}static exists(t){return new pu(void 0,t)}static updateTime(t){return new pu(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function gu(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class mu{}function yu(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Au(t.key,pu.none()):new _u(t.key,t.data,pu.none());{const n=t.data,r=Wa.empty();let i=new wa(ta.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Tu(t.key,r,new Ea(i.toArray()),pu.none())}}function vu(t,e,n){t instanceof _u?function(t,e,n){const r=t.value.clone(),i=Su(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Tu?function(t,e,n){if(!gu(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Su(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Iu(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function wu(t,e,n,r){return t instanceof _u?function(t,e,n,r){if(!gu(t.precondition,e))return n;const i=t.value.clone(),s=Cu(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Tu?function(t,e,n,r){if(!gu(t.precondition,e))return n;const i=Cu(t.fieldTransforms,r,e),s=e.data;return s.setAll(Iu(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return gu(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function bu(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=ru(r.transform,t||null);null!=i&&(null===n&&(n=Wa.empty()),n.set(r.field,i))}return n||null}function Eu(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof su&&e instanceof su||t instanceof au&&e instanceof au?Qo(t.elements,e.elements,Oa):t instanceof uu&&e instanceof uu?Oa(t.Ie,e.Ie):t instanceof iu&&e instanceof iu}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class _u extends mu{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Tu extends mu{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Iu(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Su(t,e,n){const r=new Map;xo(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,nu(o,a,n[i]))}return r}function Cu(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,eu(t,s,e))}return r}class Au extends mu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Du extends mu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ku{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&vu(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=wu(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=wu(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Kc();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=yu(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Xo.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Wc())}isEqual(t){return this.batchId===t.batchId&&Qo(this.mutations,t.mutations,((t,e)=>Eu(t,e)))&&Qo(this.baseMutations,t.baseMutations,((t,e)=>Eu(t,e)))}}class Nu{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){xo(t.mutations.length===n.length);let r=Hc;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Nu(t,e,n,r)}}class Ru{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class xu{constructor(t,e){this.count=t,this.unchangedNames=e}}var Lu,Mu;function Ou(t){if(void 0===t)return Do("GRPC error has no .code"),Mo.UNKNOWN;switch(t){case Lu.OK:return Mo.OK;case Lu.CANCELLED:return Mo.CANCELLED;case Lu.UNKNOWN:return Mo.UNKNOWN;case Lu.DEADLINE_EXCEEDED:return Mo.DEADLINE_EXCEEDED;case Lu.RESOURCE_EXHAUSTED:return Mo.RESOURCE_EXHAUSTED;case Lu.INTERNAL:return Mo.INTERNAL;case Lu.UNAVAILABLE:return Mo.UNAVAILABLE;case Lu.UNAUTHENTICATED:return Mo.UNAUTHENTICATED;case Lu.INVALID_ARGUMENT:return Mo.INVALID_ARGUMENT;case Lu.NOT_FOUND:return Mo.NOT_FOUND;case Lu.ALREADY_EXISTS:return Mo.ALREADY_EXISTS;case Lu.PERMISSION_DENIED:return Mo.PERMISSION_DENIED;case Lu.FAILED_PRECONDITION:return Mo.FAILED_PRECONDITION;case Lu.ABORTED:return Mo.ABORTED;case Lu.OUT_OF_RANGE:return Mo.OUT_OF_RANGE;case Lu.UNIMPLEMENTED:return Mo.UNIMPLEMENTED;case Lu.DATA_LOSS:return Mo.DATA_LOSS;default:return Ro()}}(Mu=Lu||(Lu={}))[Mu.OK=0]="OK",Mu[Mu.CANCELLED=1]="CANCELLED",Mu[Mu.UNKNOWN=2]="UNKNOWN",Mu[Mu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mu[Mu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mu[Mu.NOT_FOUND=5]="NOT_FOUND",Mu[Mu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mu[Mu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mu[Mu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mu[Mu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mu[Mu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mu[Mu.ABORTED=10]="ABORTED",Mu[Mu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mu[Mu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mu[Mu.INTERNAL=13]="INTERNAL",Mu[Mu.UNAVAILABLE=14]="UNAVAILABLE",Mu[Mu.DATA_LOSS=15]="DATA_LOSS";const Pu=new Eo([4294967295,4294967295],0);function Fu(t){const e=(new TextEncoder).encode(t),n=new bo;return n.update(e),new Uint8Array(n.digest())}function Vu(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Eo([n,r],0),new Eo([i,s],0)]}class Uu{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Bu(`Invalid padding: ${e}`);if(n<0)throw new Bu(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Bu(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Bu(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Eo.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Eo.fromNumber(n)));return 1===r.compare(Pu)&&(r=new Eo([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Fu(t),[n,r]=Vu(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new Uu(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Te)return;const e=Fu(t),[n,r]=Vu(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Bu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ju{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,qu.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ju(Xo.min(),r,new ma(Ho),Bc(),Wc())}}class qu{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new qu(n,e,Wc(),Wc(),Wc())}}class $u{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class zu{constructor(t,e){this.targetId=t,this.fe=e}}class Ku{constructor(t,e,n=Ta.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Gu{constructor(){this.ge=0,this.pe=Wu(),this.ye=Ta.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=Wc(),e=Wc(),n=Wc();return this.pe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ro()}})),new qu(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Wu()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,xo(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Hu{constructor(t){this.Le=t,this.ke=new Map,this.qe=Bc(),this.Qe=Qu(),this.Ke=new ma(Ho)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:Ro()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const i=r.target;if(Tc(i))if(0===n){const t=new ea(i.path);this.We(e,t,Ya.newNoDocument(t,Xo.min()))}else xo(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),i=n?this.et(n,t,r):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Aa(n).toUint8Array()}catch(t){if(t instanceof _a)return ko("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Uu(s,r,i)}catch(t){return ko(t instanceof Bu?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Tc(i.target)){const e=new ea(i.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,Ya.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=Wc();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new ju(t,e,this.Ke,this.qe,n);return this.qe=Bc(),this.Qe=Qu(),this.Ke=new ma(Ho),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Gu,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new wa(Ho),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||Ao("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new Gu),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Qu(){return new ma(ea.comparator)}function Wu(){return new ma(ea.comparator)}const Xu={asc:"ASCENDING",desc:"DESCENDING"},Yu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ju={and:"AND",or:"OR"};class Zu{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function th(t,e){return t.useProto3Json||la(e)?e:{value:e}}function eh(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nh(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function rh(t,e){return eh(t,e.toTimestamp())}function ih(t){return xo(!!t),Xo.fromTimestamp(function(t){const e=Sa(t);return new Wo(e.seconds,e.nanos)}(t))}function sh(t,e){return function(t){return new Jo(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function oh(t){const e=Jo.fromString(t);return xo(Ih(e)),e}function ah(t,e){return sh(t.databaseId,e.path)}function ch(t,e){const n=oh(e);if(n.get(1)!==t.databaseId.projectId)throw new Oo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Oo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ea(lh(n))}function uh(t,e){return sh(t.databaseId,e)}function hh(t){return new Jo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function lh(t){return xo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function dh(t,e,n){return{name:ah(t,e),fields:n.value.mapValue.fields}}function fh(t,e){return{documents:[uh(t,e.path)]}}function ph(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=uh(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=uh(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0!==t.length)return _h(sc.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:bh(t.field),direction:yh(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=th(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function gh(t){let e=function(t){const e=oh(t);return 4===e.length?Jo.emptyPath():lh(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){xo(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=mh(t);return e instanceof sc&&ac(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new ec(Eh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,la(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Ja(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Ja(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Ic(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function mh(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Eh(t.unaryFilter.field);return ic.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Eh(t.unaryFilter.field);return ic.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Eh(t.unaryFilter.field);return ic.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Eh(t.unaryFilter.field);return ic.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ro()}}(t):void 0!==t.fieldFilter?function(t){return ic.create(Eh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ro()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return sc.create(t.compositeFilter.filters.map((t=>mh(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ro()}}(t.compositeFilter.op))}(t):Ro()}function yh(t){return Xu[t]}function vh(t){return Yu[t]}function wh(t){return Ju[t]}function bh(t){return{fieldPath:t.canonicalString()}}function Eh(t){return ta.fromServerFormat(t.fieldPath)}function _h(t){return t instanceof ic?function(t){if("=="===t.op){if(Ka(t.value))return{unaryFilter:{field:bh(t.field),op:"IS_NAN"}};if(za(t.value))return{unaryFilter:{field:bh(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ka(t.value))return{unaryFilter:{field:bh(t.field),op:"IS_NOT_NAN"}};if(za(t.value))return{unaryFilter:{field:bh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bh(t.field),op:vh(t.op),value:t.value}}}(t):t instanceof sc?function(t){const e=t.getFilters().map((t=>_h(t)));return 1===e.length?e[0]:{compositeFilter:{op:wh(t.op),filters:e}}}(t):Ro()}function Th(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Ih(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Sh{constructor(t,e,n,r,i=Xo.min(),s=Xo.min(),o=Ta.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Sh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Sh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Sh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Sh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ch{constructor(t){this.ut=t}}function Ah(t){const e=gh({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Rc(e,e.limit,"L"):e}class Dh{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(Ca(t.integerValue));else if("doubleValue"in t){const n=Ca(t.doubleValue);isNaN(n)?this.Tt(e,13):(this.Tt(e,15),da(n)?e.Et(0):e.Et(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Tt(e,20),"string"==typeof n?e.dt(n):(e.dt(`${n.seconds||""}`),e.Et(n.nanos||0))}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(Aa(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Tt(e,45),e.Et(n.latitude||0),e.Et(n.longitude||0)}else"mapValue"in t?Qa(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):Ro()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){const n=t.fields||{};this.Tt(e,55);for(const t of Object.keys(n))this.At(t,e),this.Pt(n[t],e)}yt(t,e){const n=t.values||[];this.Tt(e,50);for(const t of n)this.Pt(t,e)}ft(t,e){this.Tt(e,37),ea.fromName(t).path.forEach((t=>{this.Tt(e,60),this.wt(t,e)}))}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}}Dh.St=new Dh;class kh{constructor(){this.on=new Nh}addToCollectionParentIndex(t,e){return this.on.add(e),ca.resolve()}getCollectionParents(t,e){return ca.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return ca.resolve()}deleteFieldIndex(t,e){return ca.resolve()}deleteAllFieldIndexes(t){return ca.resolve()}createTargetIndexes(t,e){return ca.resolve()}getDocumentsMatchingTarget(t,e){return ca.resolve(null)}getIndexType(t,e){return ca.resolve(0)}getFieldIndexes(t,e){return ca.resolve([])}getNextCollectionGroupToUpdate(t){return ca.resolve(null)}getMinOffset(t,e){return ca.resolve(ra.min())}getMinOffsetFromCollectionGroup(t,e){return ca.resolve(ra.min())}updateCollectionGroup(t,e,n){return ca.resolve()}updateIndexEntries(t,e){return ca.resolve()}}class Nh{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new wa(Jo.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new wa(Jo.comparator)).toArray()}}new Uint8Array(0);class Rh{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Rh(t,Rh.DEFAULT_COLLECTION_PERCENTILE,Rh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Rh.DEFAULT_COLLECTION_PERCENTILE=10,Rh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rh.DEFAULT=new Rh(41943040,Rh.DEFAULT_COLLECTION_PERCENTILE,Rh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rh.DISABLED=new Rh(-1,0,0);class xh{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new xh(0)}static Nn(){return new xh(-1)}}class Lh{constructor(){this.changes=new Vc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ya.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ca.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Mh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Oh{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&wu(n.mutation,t,Ea.empty(),Wo.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Wc()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Wc()){const r=zc();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=qc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=zc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Wc())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Bc();const s=Gc(),o=Gc();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Tu)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),wu(o.mutation,e,o.mutation.getFieldMask(),Wo.now())):s.set(e.key,Ea.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Mh(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Gc();let r=new ma(((t,e)=>t-e)),i=Wc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Ea.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||Wc()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Kc();c.forEach((t=>{if(!i.has(t)){const r=yu(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return ca.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ac(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):ca.resolve(zc());let o=-1,a=i;return s.next((e=>ca.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?ca.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,Wc()))).next((t=>({batchId:o,changes:$c(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ea(e)).next((t=>{let e=qc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=qc();return this.indexManager.getCollectionParents(t,i).next((o=>ca.forEach(o,(o=>{const a=function(t,e){return new Ic(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,Ya.newInvalidDocument(r)))}));let n=qc();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&wu(s.mutation,r,Ea.empty(),Wo.now()),Oc(e,r)&&(n=n.insert(t,r))})),n}))}}class Ph{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return ca.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ih(t.createTime)}}(e)),ca.resolve()}getNamedQuery(t,e){return ca.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(t){return{name:t.name,query:Ah(t.bundledQuery),readTime:ih(t.readTime)}}(e)),ca.resolve()}}class Fh{constructor(){this.overlays=new ma(ea.comparator),this.lr=new Map}getOverlay(t,e){return ca.resolve(this.overlays.get(e))}getOverlays(t,e){const n=zc();return ca.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.lt(t,e,r)})),ca.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.lr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.lr.delete(n)),ca.resolve()}getOverlaysForCollection(t,e,n){const r=zc(),i=e.length+1,s=new ea(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return ca.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new ma(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=zc(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=zc(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return ca.resolve(o)}lt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.lr.get(r.largestBatchId).delete(n.key);this.lr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ru(e,n));let i=this.lr.get(e);void 0===i&&(i=Wc(),this.lr.set(e,i)),this.lr.set(e,i.add(n.key))}}class Vh{constructor(){this.hr=new wa(Uh.Pr),this.Ir=new wa(Uh.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){const n=new Uh(t,e);this.hr=this.hr.add(n),this.Ir=this.Ir.add(n)}Er(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.dr(new Uh(t,e))}Ar(t,e){t.forEach((t=>this.removeReference(t,e)))}Rr(t){const e=new ea(new Jo([])),n=new Uh(e,t),r=new Uh(e,t+1),i=[];return this.Ir.forEachInRange([n,r],(t=>{this.dr(t),i.push(t.key)})),i}Vr(){this.hr.forEach((t=>this.dr(t)))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){const e=new ea(new Jo([])),n=new Uh(e,t),r=new Uh(e,t+1);let i=Wc();return this.Ir.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Uh(t,0),n=this.hr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Uh{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return ea.comparator(t.key,e.key)||Ho(t.gr,e.gr)}static Tr(t,e){return Ho(t.gr,e.gr)||ea.comparator(t.key,e.key)}}class Bh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new wa(Uh.Pr)}checkEmpty(t){return ca.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new ku(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.yr=this.yr.add(new Uh(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ca.resolve(s)}lookupMutationBatch(t,e){return ca.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.Sr(n),i=r<0?0:r;return ca.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ca.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(t){return ca.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Uh(e,0),r=new Uh(e,Number.POSITIVE_INFINITY),i=[];return this.yr.forEachInRange([n,r],(t=>{const e=this.wr(t.gr);i.push(e)})),ca.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new wa(Ho);return e.forEach((t=>{const e=new Uh(t,0),r=new Uh(t,Number.POSITIVE_INFINITY);this.yr.forEachInRange([e,r],(t=>{n=n.add(t.gr)}))})),ca.resolve(this.br(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ea.isDocumentKey(i)||(i=i.child(""));const s=new Uh(new ea(i),0);let o=new wa(Ho);return this.yr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.gr)),!0)}),s),ca.resolve(this.br(o))}br(t){const e=[];return t.forEach((t=>{const n=this.wr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){xo(0===this.Dr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.yr;return ca.forEach(e.mutations,(r=>{const i=new Uh(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.yr=n}))}Fn(t){}containsKey(t,e){const n=new Uh(e,0),r=this.yr.firstAfterOrEqual(n);return ca.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,ca.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}wr(t){const e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class jh{constructor(t){this.Cr=t,this.docs=new ma(ea.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.Cr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ca.resolve(n?n.document.mutableCopy():Ya.newInvalidDocument(e))}getEntries(t,e){let n=Bc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ya.newInvalidDocument(t))})),ca.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Bc();const s=e.path,o=new ea(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||ia(na(o),n)<=0||(r.has(o.key)||Oc(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ca.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Ro()}vr(t,e){return ca.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new qh(this)}getSize(t){return ca.resolve(this.size)}}class qh extends Lh{constructor(t){super(),this._r=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this._r.addEntry(t,r)):this._r.removeEntry(n)})),ca.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}}class $h{constructor(t){this.persistence=t,this.Fr=new Vc((t=>Ec(t)),_c),this.lastRemoteSnapshotVersion=Xo.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Vh,this.targetCount=0,this.Nr=xh.On()}forEachTarget(t,e){return this.Fr.forEach(((t,n)=>e(n))),ca.resolve()}getLastRemoteSnapshotVersion(t){return ca.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ca.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),ca.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Mr&&(this.Mr=e),ca.resolve()}kn(t){this.Fr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Nr=new xh(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,ca.resolve()}updateTargetData(t,e){return this.kn(e),ca.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,ca.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Fr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),ca.waitFor(i).next((()=>r))}getTargetCount(t){return ca.resolve(this.targetCount)}getTargetData(t,e){const n=this.Fr.get(e)||null;return ca.resolve(n)}addMatchingKeys(t,e,n){return this.Or.Er(e,n),ca.resolve()}removeMatchingKeys(t,e,n){this.Or.Ar(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),ca.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),ca.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Or.mr(e);return ca.resolve(n)}containsKey(t,e){return ca.resolve(this.Or.containsKey(e))}}class zh{constructor(t,e){this.Br={},this.overlays={},this.Lr=new ha(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new $h(this),this.indexManager=new kh,this.remoteDocumentCache=function(t){return new jh(t)}((t=>this.referenceDelegate.Qr(t))),this.serializer=new Ch(e),this.Kr=new Ph(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Fh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Bh(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,n){Ao("MemoryPersistence","Starting transaction:",t);const r=new Kh(this.Lr.next());return this.referenceDelegate.$r(),n(r).next((t=>this.referenceDelegate.Ur(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Wr(t,e){return ca.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class Kh extends oa{constructor(t){super(),this.currentSequenceNumber=t}}class Gh{constructor(t){this.persistence=t,this.Gr=new Vh,this.zr=null}static jr(t){return new Gh(t)}get Hr(){if(this.zr)return this.zr;throw Ro()}addReference(t,e,n){return this.Gr.addReference(n,e),this.Hr.delete(n.toString()),ca.resolve()}removeReference(t,e,n){return this.Gr.removeReference(n,e),this.Hr.add(n.toString()),ca.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),ca.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach((t=>this.Hr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Hr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}$r(){this.zr=new Set}Ur(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ca.forEach(this.Hr,(n=>{const r=ea.fromPath(n);return this.Jr(t,r).next((t=>{t||e.removeEntry(r,Xo.min())}))})).next((()=>(this.zr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Jr(t,e).next((t=>{t?this.Hr.delete(e.toString()):this.Hr.add(e.toString())}))}Qr(t){return 0}Jr(t,e){return ca.or([()=>ca.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}}class Hh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ki=n,this.qi=r}static Qi(t,e){let n=Wc(),r=Wc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Hh(t,e.fromCache,n,r)}}class Qh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Wh{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.zi(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.ji(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Qh;return this.Hi(t,e,n).next((r=>{if(i.result=r,this.$i)return this.Ji(t,e,n,r.size)}))})).next((()=>i.result))}Ji(t,e,n,r){return n.documentReadCount<this.Ui?(Co()<=C.DEBUG&&Ao("QueryEngine","SDK will not create cache indexes for query:",Mc(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),ca.resolve()):(Co()<=C.DEBUG&&Ao("QueryEngine","Query:",Mc(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Wi*r?(Co()<=C.DEBUG&&Ao("QueryEngine","The SDK decides to create cache indexes for query:",Mc(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kc(e))):ca.resolve())}zi(t,e){if(Cc(e))return ca.resolve(null);let n=kc(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Rc(e,null,"F"),n=kc(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=Wc(...r);return this.Gi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Yi(e,r);return this.Zi(e,s,i,n.readTime)?this.zi(t,Rc(e,null,"F")):this.Xi(t,s,e,n)}))))})))))}ji(t,e,n,r){return Cc(e)||r.isEqual(Xo.min())?ca.resolve(null):this.Gi.getDocuments(t,n).next((i=>{const s=this.Yi(e,i);return this.Zi(e,s,n,r)?ca.resolve(null):(Co()<=C.DEBUG&&Ao("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Mc(e)),this.Xi(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Xo.fromTimestamp(1e9===r?new Wo(n+1,0):new Wo(n,r));return new ra(i,ea.empty(),e)}(r,-1)).next((t=>t)))}))}Yi(t,e){let n=new wa(Pc(t));return e.forEach(((e,r)=>{Oc(t,r)&&(n=n.add(r))})),n}Zi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Hi(t,e,n){return Co()<=C.DEBUG&&Ao("QueryEngine","Using full collection scan to execute query:",Mc(e)),this.Gi.getDocumentsMatchingQuery(t,e,ra.min(),n)}Xi(t,e,n,r){return this.Gi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Xh{constructor(t,e,n,r){this.persistence=t,this.es=e,this.serializer=r,this.ts=new ma(Ho),this.ns=new Vc((t=>Ec(t)),_c),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(n)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Oh(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ts)))}}async function Yh(t,e){const n=Lo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.os(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=Wc();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({_s:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Jh(t){const e=Lo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.qr.getLastRemoteSnapshotVersion(t)))}function Zh(t,e){const n=Lo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function tl(t,e,n){const r=Lo(t),i=r.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!ua(t))throw t;Ao("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function el(t,e,n){const r=Lo(t);let i=Xo.min(),s=Wc();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Lo(t),i=r.ns.get(n);return void 0!==i?ca.resolve(r.ts.get(i)):r.qr.getTargetData(e,n)}(r,t,kc(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.es.getDocumentsMatchingQuery(t,e,n?i:Xo.min(),n?s:Wc()))).next((t=>(function(t,e,n){let r=t.rs.get(e)||Xo.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.rs.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ls:s})))))}class nl{constructor(){this.activeTargetIds=Xc}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class rl{constructor(){this.eo=new nl,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,n){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new nl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class il{ro(t){}shutdown(){}}class sl{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){Ao("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ao)t(0)}_o(){Ao("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ao)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ol=null;function al(){return null===ol?ol=268435456+Math.round(2147483648*Math.random()):ol++,"0x"+ol.toString(16)}const cl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ul{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}onMessage(t){this.Eo=t}close(){this.lo()}send(t){this.co(t)}Ao(){this.Po()}Ro(t){this.To(t)}Vo(t){this.Eo(t)}}const hl="WebChannelConnection";class ll extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.mo=e+"://"+t.host,this.fo=`projects/${n}/databases/${r}`,this.po="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get yo(){return!1}wo(t,e,n,r,i){const s=al(),o=this.So(t,e);Ao("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(a,r,i),this.Do(t,o,a,n).then((e=>(Ao("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw ko("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Co(t,e,n,r,i,s){return this.wo(t,e,n,r,i)}bo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Io,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}So(t,e){const n=cl[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Do(t,e,n,r){const i=al();return new Promise(((s,o)=>{const a=new wo;a.setWithCredentials(!0),a.listenOnce(go.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case po.NO_ERROR:const e=a.getResponseJson();Ao(hl,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case po.TIMEOUT:Ao(hl,`RPC '${t}' ${i} timed out`),o(new Oo(Mo.DEADLINE_EXCEEDED,"Request time out"));break;case po.HTTP_ERROR:const n=a.getStatus();if(Ao(hl,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Mo).indexOf(e)>=0?e:Mo.UNKNOWN}(e.status);o(new Oo(t,e.message))}else o(new Oo(Mo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Oo(Mo.UNAVAILABLE,"Connection failed."));break;default:Ro()}}finally{Ao(hl,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);Ao(hl,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}vo(t,e,n){const r=al(),i=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=lo(),o=fo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.bo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Ao(hl,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new ul({co:e=>{d?Ao(hl,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Ao(hl,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),Ao(hl,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},lo:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,vo.EventType.OPEN,(()=>{d||Ao(hl,`RPC '${t}' stream ${r} transport opened.`)})),p(h,vo.EventType.CLOSE,(()=>{d||(d=!0,Ao(hl,`RPC '${t}' stream ${r} transport closed`),f.Ro())})),p(h,vo.EventType.ERROR,(e=>{d||(d=!0,ko(hl,`RPC '${t}' stream ${r} transport errored:`,e),f.Ro(new Oo(Mo.UNAVAILABLE,"The operation could not be completed")))})),p(h,vo.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];xo(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Ao(hl,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Lu[t];if(void 0!==e)return Ou(e)}(e),i=o.message;void 0===n&&(n=Mo.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Ro(new Oo(n,i)),h.close()}else Ao(hl,`RPC '${t}' stream ${r} received:`,i),f.Vo(i)}})),p(o,mo.STAT_EVENT,(e=>{e.stat===yo.PROXY?Ao(hl,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===yo.NOPROXY&&Ao(hl,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ao()}),0),f}}function dl(){return"undefined"!=typeof document?document:null}function fl(t){return new Zu(t,!0)}class pl{constructor(t,e,n=1e3,r=1.5,i=6e4){this.si=t,this.timerId=e,this.Fo=n,this.Mo=r,this.xo=i,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(t){this.cancel();const e=Math.floor(this.Oo+this.qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&Ao("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Oo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class gl{constructor(t,e,n,r,i,s,o,a){this.si=t,this.Ko=n,this.$o=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new pl(t,e)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,(()=>this.Xo())))}e_(t){this.t_(),this.stream.send(t)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(t,e){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,4!==t?this.zo.reset():e&&e.code===Mo.RESOURCE_EXHAUSTED?(Do(e.toString()),Do("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):e&&e.code===Mo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.r_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Io(e)}r_(){}auth(){this.state=1;const t=this.i_(this.Uo),e=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Uo===e&&this.s_(t,n)}),(e=>{t((()=>{const t=new Oo(Mo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.o_(t)}))}))}s_(t,e){const n=this.i_(this.Uo);this.stream=this.__(t,e),this.stream.ho((()=>{n((()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,(()=>(this.Ho()&&(this.state=3),Promise.resolve()))),this.listener.ho())))})),this.stream.Io((t=>{n((()=>this.o_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Jo(){this.state=5,this.zo.ko((async()=>{this.state=0,this.start()}))}o_(t){return Ao("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}i_(t){return e=>{this.si.enqueueAndForget((()=>this.Uo===t?e():(Ao("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ml extends gl{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}__(t,e){return this.connection.vo("Listen",t,e)}onMessage(t){this.zo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ro()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(xo(void 0===e||"string"==typeof e),Ta.fromBase64String(e||"")):(xo(void 0===e||e instanceof Uint8Array),Ta.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Mo.UNKNOWN:Ou(t.code);return new Oo(e,t.message||"")}(o);n=new Ku(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=ch(t,r.document.name),s=ih(r.document.updateTime),o=r.document.createTime?ih(r.document.createTime):Xo.min(),a=new Wa({mapValue:{fields:r.document.fields}}),c=Ya.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new $u(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=ch(t,r.document),s=r.readTime?ih(r.readTime):Xo.min(),o=Ya.newNoDocument(i,s),a=r.removedTargetIds||[];n=new $u([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=ch(t,r.document),s=r.removedTargetIds||[];n=new $u([],s,i,null)}else{if(!("filter"in e))return Ro();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new xu(r,i),o=t.targetId;n=new zu(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Xo.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Xo.min():e.readTime?ih(e.readTime):Xo.min()}(t);return this.listener.a_(e,n)}u_(t){const e={};e.database=hh(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Tc(r)?{documents:fh(t,r)}:{query:ph(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=nh(t,e.resumeToken);const r=th(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Xo.min())>0){n.readTime=eh(t,e.snapshotVersion.toTimestamp());const r=th(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ro()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.e_(e)}c_(t){const e={};e.database=hh(this.serializer),e.removeTarget=t,this.e_(e)}}class yl extends gl{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(t,e){return this.connection.vo("Write",t,e)}onMessage(t){if(xo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.l_){this.zo.reset();const e=function(t,e){return t&&t.length>0?(xo(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?ih(t.updateTime):ih(e);return n.isEqual(Xo.min())&&(n=ih(e)),new fu(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=ih(t.commitTime);return this.listener.I_(n,e)}return xo(!t.writeResults||0===t.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const t={};t.database=hh(this.serializer),this.e_(t)}P_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof _u)n={update:dh(t,e.key,e.value)};else if(e instanceof Au)n={delete:ah(t,e.key)};else if(e instanceof Tu)n={update:dh(t,e.key,e.data),updateMask:Th(e.fieldMask)};else{if(!(e instanceof Du))return Ro();n={verify:ah(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof iu)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof su)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof au)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof uu)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw Ro()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:rh(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ro()}(t,e.precondition)),n}(this.serializer,t)))};this.e_(e)}}class vl extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.d_=!1}A_(){if(this.d_)throw new Oo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}wo(t,e,n){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.wo(t,e,n,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Oo(Mo.UNKNOWN,t.toString())}))}Co(t,e,n,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Co(t,e,n,i,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Oo(Mo.UNKNOWN,t.toString())}))}terminate(){this.d_=!0}}class wl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve()))))}w_(t){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.p_("Offline")))}set(t){this.S_(),this.V_=0,"Online"===t&&(this.f_=!1),this.p_(t)}p_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}y_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Do(e),this.f_=!1):Ao("OnlineStateTracker",e)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class bl{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=i,this.F_.ro((t=>{n.enqueueAndForget((async()=>{kl(this)&&(Ao("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Lo(t);e.C_.add(4),await _l(e),e.M_.set("Unknown"),e.C_.delete(4),await El(e)}(this))}))})),this.M_=new wl(n,r)}}async function El(t){if(kl(t))for(const e of t.v_)await e(!0)}async function _l(t){for(const e of t.v_)await e(!1)}function Tl(t,e){const n=Lo(t);n.D_.has(e.targetId)||(n.D_.set(e.targetId,e),Dl(n)?Al(n):Gl(n).Ho()&&Sl(n,e))}function Il(t,e){const n=Lo(t),r=Gl(n);n.D_.delete(e),r.Ho()&&Cl(n,e),0===n.D_.size&&(r.Ho()?r.Zo():kl(n)&&n.M_.set("Unknown"))}function Sl(t,e){if(t.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Xo.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Gl(t).u_(e)}function Cl(t,e){t.x_.Oe(e),Gl(t).c_(e)}function Al(t){t.x_=new Hu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.D_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Gl(t).start(),t.M_.g_()}function Dl(t){return kl(t)&&!Gl(t).jo()&&t.D_.size>0}function kl(t){return 0===Lo(t).C_.size}function Nl(t){t.x_=void 0}async function Rl(t){t.D_.forEach(((e,n)=>{Sl(t,e)}))}async function xl(t,e){Nl(t),Dl(t)?(t.M_.w_(e),Al(t)):t.M_.set("Unknown")}async function Ll(t,e,n){if(t.M_.set("Online"),e instanceof Ku&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.D_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.D_.delete(r),t.x_.removeTarget(r))}(t,e)}catch(n){Ao("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ml(t,n)}else if(e instanceof $u?t.x_.$e(e):e instanceof zu?t.x_.Je(e):t.x_.Ge(e),!n.isEqual(Xo.min()))try{const e=await Jh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.x_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.D_.get(r);i&&t.D_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.D_.get(e);if(!r)return;t.D_.set(e,r.withResumeToken(Ta.EMPTY_BYTE_STRING,r.snapshotVersion)),Cl(t,e);const i=new Sh(r.target,e,n,r.sequenceNumber);Sl(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Ao("RemoteStore","Failed to raise snapshot:",e),await Ml(t,e)}}async function Ml(t,e,n){if(!ua(e))throw e;t.C_.add(1),await _l(t),t.M_.set("Offline"),n||(n=()=>Jh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ao("RemoteStore","Retrying IndexedDB access"),await n(),t.C_.delete(1),await El(t)}))}function Ol(t,e){return e().catch((n=>Ml(t,n,e)))}async function Pl(t){const e=Lo(t),n=Hl(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;Fl(e);)try{const t=await Zh(e.localStore,r);if(null===t){0===e.b_.length&&n.Zo();break}r=t.batchId,Vl(e,t)}catch(t){await Ml(e,t)}Ul(e)&&Bl(e)}function Fl(t){return kl(t)&&t.b_.length<10}function Vl(t,e){t.b_.push(e);const n=Hl(t);n.Ho()&&n.h_&&n.P_(e.mutations)}function Ul(t){return kl(t)&&!Hl(t).jo()&&t.b_.length>0}function Bl(t){Hl(t).start()}async function jl(t){Hl(t).E_()}async function ql(t){const e=Hl(t);for(const n of t.b_)e.P_(n.mutations)}async function $l(t,e,n){const r=t.b_.shift(),i=Nu.from(r,e,n);await Ol(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Pl(t)}async function zl(t,e){e&&Hl(t).h_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return Ro();case Mo.CANCELLED:case Mo.UNKNOWN:case Mo.DEADLINE_EXCEEDED:case Mo.RESOURCE_EXHAUSTED:case Mo.INTERNAL:case Mo.UNAVAILABLE:case Mo.UNAUTHENTICATED:return!1;case Mo.INVALID_ARGUMENT:case Mo.NOT_FOUND:case Mo.ALREADY_EXISTS:case Mo.PERMISSION_DENIED:case Mo.FAILED_PRECONDITION:case Mo.ABORTED:case Mo.OUT_OF_RANGE:case Mo.UNIMPLEMENTED:case Mo.DATA_LOSS:return!0}}(t)&&t!==Mo.ABORTED}(e.code)){const n=t.b_.shift();Hl(t).Yo(),await Ol(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Pl(t)}}(t,e),Ul(t)&&Bl(t)}async function Kl(t,e){const n=Lo(t);n.asyncQueue.verifyOperationInProgress(),Ao("RemoteStore","RemoteStore received new credentials");const r=kl(n);n.C_.add(3),await _l(n),r&&n.M_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.C_.delete(3),await El(n)}function Gl(t){return t.O_||(t.O_=function(t,e,n){const r=Lo(t);return r.A_(),new ml(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:Rl.bind(null,t),Io:xl.bind(null,t),a_:Ll.bind(null,t)}),t.v_.push((async e=>{e?(t.O_.Yo(),Dl(t)?Al(t):t.M_.set("Unknown")):(await t.O_.stop(),Nl(t))}))),t.O_}function Hl(t){return t.N_||(t.N_=function(t,e,n){const r=Lo(t);return r.A_(),new yl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:jl.bind(null,t),Io:zl.bind(null,t),T_:ql.bind(null,t),I_:$l.bind(null,t)}),t.v_.push((async e=>{e?(t.N_.Yo(),await Pl(t)):(await t.N_.stop(),t.b_.length>0&&(Ao("RemoteStore",`Stopping write stream with ${t.b_.length} pending writes`),t.b_=[]))}))),t.N_}class Ql{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Po,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Ql(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Oo(Mo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wl(t,e){if(Do("AsyncQueue",`${e}: ${t}`),ua(t))return new Oo(Mo.UNAVAILABLE,`${e}: ${t}`);throw t}class Xl{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ea.comparator(e.key,n.key):(t,e)=>ea.comparator(t.key,e.key),this.keyedMap=qc(),this.sortedSet=new ma(this.comparator)}static emptySet(t){return new Xl(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Xl))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Xl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Yl{constructor(){this.B_=new ma(ea.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):Ro():this.B_=this.B_.insert(e,t)}L_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Jl{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Jl(t,e,Xl.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&xc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Zl{constructor(){this.k_=void 0,this.listeners=[]}}class td{constructor(){this.queries=new Vc((t=>Lc(t)),xc),this.onlineState="Unknown",this.q_=new Set}}function ed(t,e){const n=Lo(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.K_(t)&&(r=!0);i.k_=t}}r&&rd(n)}function nd(t,e,n){const r=Lo(t),i=r.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);r.queries.delete(e)}function rd(t){t.q_.forEach((t=>{t.next()}))}class id{constructor(t,e,n){this.query=t,this.U_=e,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=n||{}}K_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Jl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.W_?this.z_(t)&&(this.U_.next(t),e=!0):this.j_(t,this.onlineState)&&(this.H_(t),e=!0),this.G_=t,e}onError(t){this.U_.error(t)}Q_(t){this.onlineState=t;let e=!1;return this.G_&&!this.W_&&this.j_(this.G_,t)&&(this.H_(this.G_),e=!0),e}j_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.J_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}z_(t){if(t.docChanges.length>0)return!0;const e=this.G_&&this.G_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}H_(t){t=Jl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.W_=!0,this.U_.next(t)}}class sd{constructor(t){this.key=t}}class od{constructor(t){this.key=t}}class ad{constructor(t,e){this.query=t,this.ia=e,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=Wc(),this.mutatedKeys=Wc(),this._a=Pc(t),this.aa=new Xl(this._a)}get ua(){return this.ia}ca(t,e){const n=e?e.la:new Yl,r=e?e.aa:this.aa;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Oc(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ha(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this._a(h,a)>0||c&&this._a(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{aa:s,la:n,Zi:o,mutatedKeys:i}}ha(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.aa;this.aa=t.aa,this.mutatedKeys=t.mutatedKeys;const s=t.la.L_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ro()}};return n(t)-n(e)}(t.type,e.type)||this._a(t.doc,e.doc))),this.Pa(n),r=null!=r&&r;const o=e&&!r?this.Ia():[],a=0===this.oa.size&&this.current&&!r?1:0,c=a!==this.sa;return this.sa=a,0!==s.length||c?{snapshot:new Jl(this.query,t.aa,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ta:o}:{Ta:o}}Q_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({aa:this.aa,la:new Yl,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(t){return!this.ia.has(t)&&!!this.aa.has(t)&&!this.aa.get(t).hasLocalMutations}Pa(t){t&&(t.addedDocuments.forEach((t=>this.ia=this.ia.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ia=this.ia.delete(t))),this.current=t.current)}Ia(){if(!this.current)return[];const t=this.oa;this.oa=Wc(),this.aa.forEach((t=>{this.Ea(t.key)&&(this.oa=this.oa.add(t.key))}));const e=[];return t.forEach((t=>{this.oa.has(t)||e.push(new od(t))})),this.oa.forEach((n=>{t.has(n)||e.push(new sd(n))})),e}da(t){this.ia=t.ls,this.oa=Wc();const e=this.ca(t.documents);return this.applyChanges(e,!0)}Aa(){return Jl.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class cd{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ud{constructor(t){this.key=t,this.Ra=!1}}class hd{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Va={},this.ma=new Vc((t=>Lc(t)),xc),this.fa=new Map,this.ga=new Set,this.pa=new ma(ea.comparator),this.ya=new Map,this.wa=new Vh,this.Sa={},this.ba=new Map,this.Da=xh.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}async function ld(t,e){const n=function(t){const e=Lo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=fd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ad.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gd.bind(null,e),e.Va.a_=ed.bind(null,e.eventManager),e.Va.Fa=nd.bind(null,e.eventManager),e}(t);let r,i;const s=n.ma.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const t=await function(t,e){const n=Lo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.qr.getTargetData(t,e).next((i=>i?(r=i,ca.resolve(r)):n.qr.allocateTargetId(t).next((i=>(r=new Sh(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ts.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ts=n.ts.insert(t.targetId,t),n.ns.set(e,t.targetId)),t}))}(n.localStore,kc(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,i=await async function(t,e,n,r,i){t.va=(e,n,r)=>async function(t,e,n,r){let i=e.view.ca(n);i.Zi&&(i=await el(t.localStore,e.query,!1).then((({documents:t})=>e.view.ca(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return _d(t,e.targetId,a.Ta),a.snapshot}(t,e,n,r);const s=await el(t.localStore,e,!0),o=new ad(e,s.ls),a=o.ca(s.documents),c=qu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);_d(t,n,u.Ta);const h=new cd(e,n,o);return t.ma.set(e,h),t.fa.has(n)?t.fa.get(n).push(e):t.fa.set(n,[e]),u.snapshot}(n,e,r,"current"===s,t.resumeToken),n.isPrimaryClient&&Tl(n.remoteStore,t)}return i}async function dd(t,e){const n=Lo(t),r=n.ma.get(e),i=n.fa.get(r.targetId);if(i.length>1)return n.fa.set(r.targetId,i.filter((t=>!xc(t,e)))),void n.ma.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await tl(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Il(n.remoteStore,r.targetId),bd(n,r.targetId)})).catch(aa)):(bd(n,r.targetId),await tl(n.localStore,r.targetId,!0))}async function fd(t,e){const n=Lo(t);try{const t=await function(t,e){const n=Lo(t),r=e.snapshotVersion;let i=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.ss.newChangeBuffer({trackRemovals:!0});i=n.ts;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.qr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Ta.EMPTY_BYTE_STRING,Xo.min()).withLastLimboFreeSnapshotVersion(Xo.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.qr.updateTargetData(t,u))}));let a=Bc(),c=Wc();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=Wc(),i=Wc();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Bc();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Xo.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Ao("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{us:r,cs:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.us,c=t.cs}))),!r.isEqual(Xo.min())){const e=n.qr.getLastRemoteSnapshotVersion(t).next((e=>n.qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return ca.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ts=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.ya.get(e);r&&(xo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Ra=!0:t.modifiedDocuments.size>0?xo(r.Ra):t.removedDocuments.size>0&&(xo(r.Ra),r.Ra=!1))})),await Sd(n,t,e)}catch(t){await aa(t)}}function pd(t,e,n){const r=Lo(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ma.forEach(((n,r)=>{const i=r.view.Q_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Lo(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Q_(e)&&(r=!0)})),r&&rd(n)}(r.eventManager,e),t.length&&r.Va.a_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function gd(t,e,n){const r=Lo(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.ya.get(e),s=i&&i.key;if(s){let t=new ma(ea.comparator);t=t.insert(s,Ya.newNoDocument(s,Xo.min()));const n=Wc().add(s),i=new ju(Xo.min(),new Map,new ma(Ho),t,n);await fd(r,i),r.pa=r.pa.remove(s),r.ya.delete(e),Id(r)}else await tl(r.localStore,e,!1).then((()=>bd(r,e,n))).catch(aa)}async function md(t,e){const n=Lo(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Lo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.ss.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=ca.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);xo(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Wc();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);wd(n,r,null),vd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Sd(n,t)}catch(t){await aa(t)}}async function yd(t,e,n){const r=Lo(t);try{const t=await function(t,e){const n=Lo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(xo(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);wd(r,e,n),vd(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Sd(r,t)}catch(n){await aa(n)}}function vd(t,e){(t.ba.get(e)||[]).forEach((t=>{t.resolve()})),t.ba.delete(e)}function wd(t,e,n){const r=Lo(t);let i=r.Sa[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function bd(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.fa.get(e))t.ma.delete(r),n&&t.Va.Fa(r,n);t.fa.delete(e),t.isPrimaryClient&&t.wa.Rr(e).forEach((e=>{t.wa.containsKey(e)||Ed(t,e)}))}function Ed(t,e){t.ga.delete(e.path.canonicalString());const n=t.pa.get(e);null!==n&&(Il(t.remoteStore,n),t.pa=t.pa.remove(e),t.ya.delete(n),Id(t))}function _d(t,e,n){for(const r of n)r instanceof sd?(t.wa.addReference(r.key,e),Td(t,r)):r instanceof od?(Ao("SyncEngine","Document no longer in limbo: "+r.key),t.wa.removeReference(r.key,e),t.wa.containsKey(r.key)||Ed(t,r.key)):Ro()}function Td(t,e){const n=e.key,r=n.path.canonicalString();t.pa.get(n)||t.ga.has(r)||(Ao("SyncEngine","New document in limbo: "+n),t.ga.add(r),Id(t))}function Id(t){for(;t.ga.size>0&&t.pa.size<t.maxConcurrentLimboResolutions;){const e=t.ga.values().next().value;t.ga.delete(e);const n=new ea(Jo.fromString(e)),r=t.Da.next();t.ya.set(r,new ud(n)),t.pa=t.pa.insert(n,r),Tl(t.remoteStore,new Sh(kc(Sc(n.path)),r,"TargetPurposeLimboResolution",ha._e))}}async function Sd(t,e,n){const r=Lo(t),i=[],s=[],o=[];r.ma.isEmpty()||(r.ma.forEach(((t,a)=>{o.push(r.va(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=Hh.Qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Va.a_(i),await async function(t,e){const n=Lo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ca.forEach(e,(e=>ca.forEach(e.ki,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>ca.forEach(e.qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!ua(t))throw t;Ao("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ts.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ts=n.ts.insert(e,i)}}}(r.localStore,s))}async function Cd(t,e){const n=Lo(t);if(!n.currentUser.isEqual(e)){Ao("SyncEngine","User change. New user:",e.toKey());const t=await Yh(n.localStore,e);n.currentUser=e,function(t,e){t.ba.forEach((t=>{t.forEach((t=>{t.reject(new Oo(Mo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ba.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Sd(n,t._s)}}function Ad(t,e){const n=Lo(t),r=n.ya.get(e);if(r&&r.Ra)return Wc().add(r.key);{let t=Wc();const r=n.fa.get(e);if(!r)return t;for(const e of r){const r=n.ma.get(e);t=t.unionWith(r.view.ua)}return t}}function Dd(t){const e=Lo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=md.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yd.bind(null,e),e}class kd{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=fl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Xh(t,e,n,r)}(this.persistence,new Wh,t.initialUser,this.serializer)}createPersistence(t){return new zh(Gh.jr,this.serializer)}createSharedClientState(t){return new rl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Nd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>pd(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Cd.bind(null,this.syncEngine),await async function(t,e){const n=Lo(t);e?(n.C_.delete(2),await El(n)):e||(n.C_.add(2),await _l(n),n.M_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new td}createDatastore(t){const e=fl(t.databaseInfo.databaseId),n=function(t){return new ll(t)}(t.databaseInfo);return function(t,e,n,r){return new vl(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new bl(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>pd(this.syncEngine,t,0)),sl.D()?new sl:new il)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new hd(t,e,n,r,i,s);return o&&(a.Ca=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Lo(t);Ao("RemoteStore","RemoteStore shutting down."),e.C_.add(5),await _l(e),e.F_.shutdown(),e.M_.set("Unknown")}(this.remoteStore)}}class Rd{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Oa(this.observer.next,t)}error(t){this.observer.error?this.Oa(this.observer.error,t):Do("Uncaught Error in snapshot listener:",t.toString())}Na(){this.muted=!0}Oa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class xd{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=To.UNAUTHENTICATED,this.clientId=Go.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Ao("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Ao("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Oo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Po;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Wl(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Ld(t,e){t.asyncQueue.verifyOperationInProgress(),Ao("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Yh(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Md(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ao("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ld(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Mo.FAILED_PRECONDITION||t.code===Mo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;ko("Error using user provided cache. Falling back to memory cache: "+n),await Ld(t,new kd)}}else Ao("FirestoreClient","Using default OfflineComponentProvider"),await Ld(t,new kd);return t._offlineComponents}(t);Ao("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>Kl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Kl(e.remoteStore,n))),t._onlineComponents=e}async function Od(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ao("FirestoreClient","Using user provided OnlineComponentProvider"),await Md(t,t._uninitializedComponentsProvider._online)):(Ao("FirestoreClient","Using default OnlineComponentProvider"),await Md(t,new Nd))),t._onlineComponents}async function Pd(t){const e=await Od(t),n=e.eventManager;return n.onListen=ld.bind(null,e.syncEngine),n.onUnlisten=dd.bind(null,e.syncEngine),n}function Fd(t,e,n={}){const r=new Po;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new Rd({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Lo(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}(t,o))),n.fromCache&&"server"===r.source?i.reject(new Oo(Mo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new id(n,s,{includeMetadataChanges:!0,J_:!0});return async function(t,e){const n=Lo(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Zl),i)try{s.k_=await n.onListen(r)}catch(t){const n=Wl(t,`Initialization of query '${Mc(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.listeners.push(e),e.Q_(n.onlineState),s.k_&&e.K_(s.k_)&&rd(n)}(t,o)}(await Pd(t),t.asyncQueue,e,n,r))),r.promise}function Vd(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Ud=new Map;function Bd(t,e,n){if(!n)throw new Oo(Mo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jd(t){if(!ea.isDocumentKey(t))throw new Oo(Mo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function qd(t){if(ea.isDocumentKey(t))throw new Oo(Mo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $d(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ro()}function zd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Oo(Mo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=$d(t);throw new Oo(Mo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Kd{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Oo(Mo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Oo(Mo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Oo(Mo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vd(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Gd{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Kd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Oo(Mo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Oo(Mo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Kd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Vo;switch(t.type){case"firstParty":return new qo(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Oo(Mo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Ud.get(t);e&&(Ao("ComponentProvider","Removing Datastore"),Ud.delete(t),e.terminate())}(this),Promise.resolve()}}class Hd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Hd(this.firestore,t,this._query)}}class Qd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Qd(this.firestore,t,this._key)}}class Wd extends Hd{constructor(t,e,n){super(t,e,Sc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Qd(this.firestore,null,new ea(t))}withConverter(t){return new Wd(this.firestore,t,this._path)}}function Xd(t,e,...n){if(t=b(t),1===arguments.length&&(e=Go.newId()),Bd("doc","path",e),t instanceof Gd){const r=Jo.fromString(e,...n);return jd(r),new Qd(t,null,new ea(r))}{if(!(t instanceof Qd||t instanceof Wd))throw new Oo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Jo.fromString(e,...n));return jd(r),new Qd(t.firestore,t instanceof Wd?t.converter:null,new ea(r))}}class Yd{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new pl(this,"async_queue_retry"),this.iu=()=>{const t=dl();t&&Ao("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const t=dl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.su(),this.ou(t)}enterRestrictedMode(t){if(!this.Za){this.Za=!0,this.nu=t||!1;const e=dl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.iu)}}enqueue(t){if(this.su(),this.Za)return new Promise((()=>{}));const e=new Po;return this.ou((()=>this.Za&&this.nu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ya.push(t),this._u())))}async _u(){if(0!==this.Ya.length){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(t){if(!ua(t))throw t;Ao("AsyncQueue","Operation failed with retryable error: "+t)}this.Ya.length>0&&this.zo.ko((()=>this._u()))}}ou(t){const e=this.Ja.then((()=>(this.tu=!0,t().catch((t=>{this.eu=t,this.tu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Do("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.tu=!1,t))))));return this.Ja=e,e}enqueueAfterDelay(t,e,n){this.su(),this.ru.indexOf(t)>-1&&(e=0);const r=Ql.createAndSchedule(this,t,e,n,(t=>this.au(t)));return this.Xa.push(r),r}su(){this.eu&&Ro()}verifyOperationInProgress(){}async uu(){let t;do{t=this.Ja,await t}while(t!==this.Ja)}cu(t){for(const e of this.Xa)if(e.timerId===t)return!0;return!1}lu(t){return this.uu().then((()=>{this.Xa.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Xa)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.uu()}))}hu(t){this.ru.push(t)}au(t){const e=this.Xa.indexOf(t);this.Xa.splice(e,1)}}class Jd extends Gd{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Yd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||tf(this),this._firestoreClient.terminate()}}function Zd(t){return t._firestoreClient||tf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function tf(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Ra(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Vd(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new xd(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class ef{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ef(Ta.fromBase64String(t))}catch(t){throw new Oo(Mo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ef(Ta.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class nf{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Oo(Mo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ta(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class rf{constructor(t){this._methodName=t}}class sf{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Oo(Mo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Oo(Mo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ho(this._lat,t._lat)||Ho(this._long,t._long)}}const of=/^__.*__$/;class af{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Tu(t,this.data,this.fieldMask,e,this.fieldTransforms):new _u(t,this.data,e,this.fieldTransforms)}}function cf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ro()}}class uf{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(t){return new uf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tu({path:n,du:!1});return r.Au(t),r}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tu({path:n,du:!1});return r.Pu(),r}Vu(t){return this.Tu({path:void 0,du:!0})}mu(t){return Ef(t,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Pu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Au(this.path.get(t))}Au(t){if(0===t.length)throw this.mu("Document fields must not be empty");if(cf(this.Iu)&&of.test(t))throw this.mu('Document fields cannot begin and end with "__"')}}class hf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||fl(t)}pu(t,e,n,r=!1){return new uf({Iu:t,methodName:e,gu:n,path:ta.emptyPath(),du:!1,fu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lf(t){const e=t._freezeSettings(),n=fl(t._databaseId);return new hf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function df(t,e,n,r,i,s={}){const o=t.pu(s.merge||s.mergeFields?2:0,e,n,i);yf("Data must be an object, but it was:",o,r);const a=gf(r,o);let c,u;if(s.merge)c=new Ea(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=vf(e,r,n);if(!o.contains(i))throw new Oo(Mo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);_f(t,i)||t.push(i)}c=new Ea(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new af(new Wa(a),c,u)}class ff extends rf{_toFieldTransform(t){return new du(t.path,new iu)}isEqual(t){return t instanceof ff}}function pf(t,e){if(mf(t=b(t)))return yf("Unsupported field value:",e,t),gf(t,e);if(t instanceof rf)return function(t,e){if(!cf(e.Iu))throw e.mu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.mu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=pf(i,e.Vu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Zc(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Wo.fromDate(t);return{timestampValue:eh(e.serializer,n)}}if(t instanceof Wo){const n=new Wo(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:eh(e.serializer,n)}}if(t instanceof sf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ef)return{bytesValue:nh(e.serializer,t._byteString)};if(t instanceof Qd){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.mu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:sh(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.mu(`Unsupported field value: ${$d(t)}`)}(t,e)}function gf(t,e){const n={};return ga(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pa(t,((t,r)=>{const i=pf(r,e.Eu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function mf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Wo||t instanceof sf||t instanceof ef||t instanceof Qd||t instanceof rf)}function yf(t,e,n){if(!mf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=$d(n);throw"an object"===r?e.mu(t+" a custom object"):e.mu(t+" "+r)}}function vf(t,e,n){if((e=b(e))instanceof nf)return e._internalPath;if("string"==typeof e)return bf(t,e);throw Ef("Field path arguments must be of type string or ",t,!1,void 0,n)}const wf=new RegExp("[~\\*/\\[\\]]");function bf(t,e,n){if(e.search(wf)>=0)throw Ef(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new nf(...e.split("."))._internalPath}catch(r){throw Ef(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ef(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Oo(Mo.INVALID_ARGUMENT,a+t+c)}function _f(t,e){return t.some((t=>t.isEqual(e)))}class Tf{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Qd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new If(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class If extends Tf{data(){return super.data()}}function Sf(t,e){return"string"==typeof e?bf(t,e):e instanceof nf?e._internalPath:e._delegate._internalPath}class Cf{}class Af extends Cf{}class Df extends Af{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Df(t,e,n)}_apply(t){const e=this._parse(t);return Lf(t._query,e),new Hd(t.firestore,t.converter,Nc(t._query,e))}_parse(t){const e=lf(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){xf(o,s);const e=[];for(const n of o)e.push(Rf(r,t,n));a={arrayValue:{values:e}}}else a=Rf(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||xf(o,s),a=function(t,e,n,r=!1){return pf(n,t.pu(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);return ic.create(i,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class kf extends Cf{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new kf(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:sc.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)Lf(n,t),n=Nc(n,t)}(t._query,e),new Hd(t.firestore,t.converter,Nc(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Nf extends Af{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Nf(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Oo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Oo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ec(e,n)}(t._query,this._field,this._direction);return new Hd(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Ic(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Rf(t,e,n){if("string"==typeof(n=b(n))){if(""===n)throw new Oo(Mo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ac(e)&&-1!==n.indexOf("/"))throw new Oo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Jo.fromString(n));if(!ea.isDocumentKey(r))throw new Oo(Mo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ja(t,new ea(r))}if(n instanceof Qd)return ja(t,n._key);throw new Oo(Mo.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$d(n)}.`)}function xf(t,e){if(!Array.isArray(t)||0===t.length)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Lf(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Oo(Mo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Oo(Mo.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Mf{convertValue(t,e="none"){switch(Ma(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ca(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Aa(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ro()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return pa(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new sf(Ca(t.latitude),Ca(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ka(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Na(t));default:return null}}convertTimestamp(t){const e=Sa(t);return new Wo(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Jo.fromString(t);xo(Ih(n));const r=new xa(n.get(1),n.get(3)),i=new ea(n.popFirst(5));return r.isEqual(e)||Do(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Of{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pf extends Tf{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ff(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ff extends Pf{data(t={}){return super.data(t)}}class Vf{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Of(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Ff(this._firestore,this._userDataWriter,n.key,n,new Of(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Oo(Mo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Ff(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Of(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Ff(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Of(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Uf(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Uf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ro()}}class Bf extends Mf{constructor(t){super(),this.firestore=t}convertBytes(t){return new ef(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Qd(this.firestore,null,e)}}function jf(t,e){return function(t,e){const n=new Po;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Dd(t);try{const t=await function(t,e){const n=Lo(t),r=Wo.now(),i=e.reduce(((t,e)=>t.add(e.key)),Wc());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Bc(),c=Wc();return n.ss.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=bu(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Tu(t.key,e,Xa(e.value.mapValue),pu.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:$c(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Sa[t.currentUser.toKey()];r||(r=new ma(Ho)),r=r.insert(e,n),t.Sa[t.currentUser.toKey()]=r}(r,t.batchId,n),await Sd(r,t.changes),await Pl(r.remoteStore)}catch(t){const e=Wl(t,"Failed to persist write");n.reject(e)}}(await function(t){return Od(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Zd(t),e)}new WeakMap,function(t,e=!0){Io="10.7.1",st(new E("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Jd(new Bo(t.getProvider("auth-internal")),new zo(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Oo(Mo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xa(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),lt(_o,"4.4.0",t),lt(_o,"4.4.0","esm2017")}();const qf=new kakao.maps.LatLng(37.400555,127.111465),$f=new kakao.maps.Map(document.querySelector("#map"),{center:qf}),zf=new kakao.maps.LatLngBounds;zf.extend(qf),$f.setBounds(zf),new kakao.maps.Marker({position:qf}).setMap($f),$f.addControl(new kakao.maps.ZoomControl,kakao.maps.ControlPosition.RIGHT),document.querySelectorAll(".account").forEach((t=>{t.addEventListener("click",(()=>{const e={groom:"박주빈 ㅇㅇ은행 00000000000000",groomFather:"박종국 ㅇㅇ은행 00000000000000",groomMother:"한성숙 ㅇㅇ은행 00000000000000",bride:"이승후 ㅇㅇ은행 00000000000000",brideFather:"성이름 ㅇㅇ은행 00000000000000",brideMother:"성이름 ㅇㅇ은행 00000000000000"}[t.id];navigator.clipboard.writeText(e).then((()=>{alert("계좌번호를 복사했습니다.\n"+e)}),(()=>{alert("계좌번호를 복사하지 못했습니다.\n"+e)}))}))})),Kakao.init("ea34a43f1bb28341f65031b415ac9f58"),document.querySelector("#share").addEventListener("click",(()=>{Kakao.Share.sendCustom({templateId:87412})}));const Kf=ut({apiKey:"AIzaSyDK2a3VYeYctmuCDnZYdcSIfjNVUeJvmWQ",authDomain:"wedding-invitation-9311b.firebaseapp.com",projectId:"wedding-invitation-9311b",storageBucket:"wedding-invitation-9311b.appspot.com",messagingSenderId:"166455853669",appId:"1:166455853669:web:11ffd8b897f80216e1bc8c",measurementId:"G-2RQXF8K1HC"}),Gf=(function(t=ht()){const e=ot(t=b(t),Ce);e.isInitialized()?e.getImmediate():function(t,e={}){const n=ot(t,Ce);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw Le.create("already-initialized")}n.initialize({options:e})}(t)}(Kf),function(t,e,...n){if(t=b(t),Bd("collection","path",e),t instanceof Gd){const r=Jo.fromString(e,...n);return qd(r),new Wd(t,null,r)}{if(!(t instanceof Qd||t instanceof Wd))throw new Oo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Jo.fromString(e,...n));return qd(r),new Wd(t.firestore,null,r)}}(function(t,e){const n="string"==typeof t?t:"(default)",r=ot("object"==typeof t?t:ht(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=zd(t,Gd))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&ko("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=To.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Oo(Mo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new To(o)}t._authCredentials=new Uo(new Fo(e,n))}}(r,...t)}return r}(Kf),"messages"));function Hf(){const t=document.querySelector("#messages");t.innerHTML="",function(t){t=zd(t,Hd);const e=zd(t.firestore,Jd),n=Zd(e),r=new Bf(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Oo(Mo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Fd(n,t._query).then((n=>new Vf(e,r,t,n)))}(function(t,e,...n){let r=[];e instanceof Cf&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof kf)).length,n=t.filter((t=>t instanceof Df)).length;if(e>1||e>0&&n>0)throw new Oo(Mo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}(Gf,function(t,e="asc"){const n=e,r=Sf("orderBy","timestamp");return Nf._create(r,n)}(0,"desc"))).then((e=>{e.forEach((e=>{const n=e.data(),r=document.createElement("span");r.appendChild(document.createTextNode(n.name));const i=document.createElement("span");i.appendChild(document.createTextNode("x"));const s=document.createElement("div");s.className="w-6 c-gray c-p",s.appendChild(i),s.addEventListener("click",(()=>{var t;prompt("비밀번호를 입력하세요.","").trim()===n.password?(t=Xd(Gf,e.id),jf(zd(t.firestore,Jd),[new Au(t._key,pu.none())])).then((()=>{alert("메시지를 삭제했습니다."),Hf()}),(()=>{alert("메시지를 삭제하지 못했습니다.")})).catch((()=>{alert("메시지를 삭제하지 못했습니다.")})):alert("비밀번호가 틀렸습니다.")}));const o=document.createElement("div");o.className="w-60 fd-r jc-sb",o.appendChild(r),o.appendChild(s);const a=document.createElement("span");a.appendChild(document.createTextNode(n.message));const c=document.createElement("div");c.className="mt-5 fs-3",c.appendChild(a);const u=document.createElement("div");u.className="mt-10 w-60 ai-fs",u.appendChild(o),u.appendChild(c),t.appendChild(u)}))}),(()=>{alert("메시지를 불러오지 못했습니다.")})).catch((()=>{alert("메시지를 불러오지 못했습니다.")}))}document.querySelector("form").addEventListener("submit",(t=>{t.preventDefault(),function(t,e){const n=zd(t.firestore,Jd),r=Xd(t),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return jf(n,[df(lf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,pu.exists(!1))]).then((()=>r))}(Gf,{name:document.querySelector("#name").value.trim(),message:document.querySelector("#message").value.trim(),password:document.querySelector("#password").value.trim(),timestamp:new ff("serverTimestamp")}).then((()=>{alert("메시지를 등록했습니다."),Hf()}),(()=>{alert("메시지를 등록하지 못했습니다.")})).catch((()=>{alert("메시지를 등록하지 못했습니다.")}))})),Hf()})();